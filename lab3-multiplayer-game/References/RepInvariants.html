<!DOCTYPE html>
<!-- saved from url=(0083)https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<title>Reading 7: Abstraction Functions &amp; Rep Invariants</title>

<link href="./RepInvariants_files/handout-style.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="https://web.mit.edu/6.102/www/sp25/general/icons/6102.ico"><link rel="apple-touch-icon" href="https://web.mit.edu/6.102/www/sp25/general/icons/6102.png"></head>
<body data-new-gr-c-s-check-loaded="14.1261.0" data-gr-ext-installed=""><header class="chip"><a href="http://web.mit.edu/6.102/www/sp25/">6.102</a></header><header><a href="http://web.mit.edu/6.102/www/sp25/">6.102 — Software Construction</a><div>Spring 2025</div></header><div class="margin col-sm-2"></div>
<nav class="table-of-contents col-sm-2"><ul class="nav"><li class="active"><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#reading_7_abstraction_functions_rep_invariants">Reading 7: Abstraction Functions &amp; Rep Invariants</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#invariants">Invariants</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#rep_invariant_and_abstraction_function">Rep invariant and abstraction function</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#benevolent_side-effects">Benevolent side-effects</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#documenting_the_af_ri_and_safety_from_rep_exposure">Documenting the AF, RI, and safety from rep exposure</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#adt_invariants_replace_preconditions">ADT invariants replace preconditions</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#recipes_for_programming">Recipes for programming</a></li><li><a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#summary">Summary</a></li></ul></nav>
<main class="container-fluid"><h1 class="handout-title col-sm-8 col-sm-offset-2" id="reading_7_abstraction_functions_rep_invariants"><iframe class="exercises-status" src="./RepInvariants_files/status.html"></iframe><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#reading_7_abstraction_functions_rep_invariants"></a>Reading 7: Abstraction Functions &amp; Rep Invariants</h1><div data-outline="reading_7_abstraction_functions_rep_invariants">


<div class="markdown col-sm-8 col-sm-offset-2 converted"><h4 id="@software_6-102"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@software_6-102"></a>Software in 6.102</h4>

<table class="table table-striped no-markdown" id="@safe_bugseasy_understandready">
<tbody><tr><th width="33%"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@safe_bugseasy_understandready"></a>Safe from bugs</th><th>Easy to understand</th><th>Ready for change</th></tr>
<tr><td>
  Correct today and correct in the unknown future.
</td><td>
  Communicating clearly with future programmers, including future you.
</td><td>
  Designed to accommodate change without rewriting.
</td></tr>
</tbody></table>

<h4 id="@objectives"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@objectives"></a>Objectives</h4>

<p id="@today-s_reading_introduces"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@today-s_reading_introduces"></a>Today’s reading introduces several ideas:</p>

<ul id="@invariants_representation_exposure">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@invariants_representation_exposure"></a>invariants</li>
<li>representation exposure</li>
<li>abstraction functions</li>
<li>representation invariants</li>
</ul>

<p id="@reading_study_more"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_study_more"></a>In this reading, we study a more formal mathematical idea of what it means for a class to implement an ADT via the notions of <em>abstraction functions</em> and <em>rep invariants</em>.
These mathematical notions are eminently practical in software design.
The abstraction function gives us a way to cleanly define the equality operation on an abstract data type (which we’ll discuss in more depth in a future class).
The rep invariant makes it easier to catch bugs caused by a corrupted data structure.</p>

<h2 id="invariants"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#invariants"></a>Invariants</h2><div data-outline="invariants">

<p id="@resuming_our_discussion"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@resuming_our_discussion"></a>Resuming our discussion of what makes a good abstract data type, the final, and perhaps most important, property of a good abstract data type is that it <strong>preserves its own invariants</strong>.
An <mark data-structure-text="invariant" id="^invariant"><em>invariant</em></mark> is a property of a program that is always true, for every possible runtime state of the program, given it was true at the beginning. You may recall this concept of a preserved invariant from 6.1200 [formerly 6.042].
Immutability is one crucial invariant that we’ve already encountered: once created, an immutable object should always represent the same value, for its entire lifetime.
But there are many other kinds of invariants, including types of variables (<code>i: number</code> means that <code>i</code> is always a number), or relationships between variables (e.g. when <code>i</code> is used to loop over the indices of an array, then <code>0 &lt;= i &lt; array.length</code> is an invariant within the body of the loop).</p>

<p id="@saying_adt_preserves"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@saying_adt_preserves"></a>Saying that the ADT <em>preserves its own invariants</em> means that the ADT is responsible for ensuring that its own invariants hold.
This is done by hiding or protecting the variables involved in the invariants (e.g., using language features like <code>private</code>), and allowing access only through operations with well-defined contracts.</p>

<p id="@adt_preserves_own"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@adt_preserves_own"></a>When an ADT preserves its own invariants, reasoning about the code becomes much easier.
If you can count on the fact that strings are immutable, for example, then you can rule out the possibility that a string has been mutated when you’re debugging code that uses strings – or when you’re trying to establish an invariant for another ADT that uses strings.
Contrast that with a mutable string type, which can be mutated by any code that has access to it.
To reason about a bug or invariant involving a mutable string, you’d have to check all the places in the code where the string might be accessible.</p>

<p id="@argument_applies_all"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@argument_applies_all"></a>That argument applies in all situations, even when you’re programming by yourself.  But when you are programming in a team, or writing software to be used by developers outside your team, ADTs that preserve their own invariants are safer from bugs too.
There won’t be nearly as high a chance of other teams in the company misusing your code, or real-world users accidentally breaking your software.</p>

<div class="reading-exercises exercises panel-group converted" id="ex-invariants"><h4 class="text-danger" id="@reading_exercises_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_0"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-invariants-statically-checked_invariants" data-target="#ex-invariants-statically-checked_invariants" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-invariants-statically-checked_invariants"></a><span class="panel-title">Statically-checked invariants</span></div><div class="panel-collapse collapse exercise-panel" id="ex-invariants-statically-checked_invariants" data-outline="statically-checked_invariants" data-ex-id="invariants/statically-checked_invariants" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@already_accustomed_declaring"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@already_accustomed_declaring"></a>We’re already accustomed to declaring some useful invariants.
Consider this line of code:</p>

<pre id="@const_names_array-string"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@const_names_array-string"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">const</span> names: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"Huey"</span>, <span class="hljs-string">"Dewey"</span>, <span class="hljs-string">"Louie"</span>];</code></pre>

<p id="@which_following_invariants"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_invariants"></a>Which of the following are invariants expressed by this code?</p>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="names refers to an object of type Array"><label for="md_converted_choice_1_0"><input type="checkbox" id="md_converted_choice_1_0"><code>names</code> refers to an object of type <code>Array</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="every element of names is the name of a real person"><label for="md_converted_choice_1_1"><input type="checkbox" id="md_converted_choice_1_1">every element of <code>names</code> is the name of a real person</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="every element of names is an object of type string"><label for="md_converted_choice_1_2"><input type="checkbox" id="md_converted_choice_1_2">every element of <code>names</code> is an object of type <code>string</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="the first element of names is the string &quot;Huey&quot;"><label for="md_converted_choice_1_3"><input type="checkbox" id="md_converted_choice_1_3">the first element of <code>names</code> is the string <code>"Huey"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

<h3 id="immutability"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#immutability"></a>Immutability</h3><div data-outline="immutability">

<p id="@later_reading_see"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@later_reading_see"></a>Later in this reading, we’ll see many interesting invariants.
Let’s focus on immutability for now. Here’s a specific example:</p>

<pre id="@immutable_data_type"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@immutable_data_type"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * This immutable data type represents a tweet from Twitter.
 */</span>
<span class="hljs-keyword">class</span> Tweet {

    <span class="hljs-keyword">public</span> author: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">public</span> text: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">public</span> timestamp: <span class="hljs-built_in">Date</span>;

    <span class="hljs-comment">/**
     * Make a Tweet.
     * @param author    Twitter user who wrote the tweet
     * @param text      text of the tweet
     * @param timestamp date/time when the tweet was sent
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">author: <span class="hljs-built_in">string</span>, text: <span class="hljs-built_in">string</span>, timestamp: <span class="hljs-built_in">Date</span></span>) {
        <span class="hljs-keyword">this</span>.author = author;
        <span class="hljs-keyword">this</span>.text = text;
        <span class="hljs-keyword">this</span>.timestamp = timestamp;
    }
}</code></pre>

<p id="@do_guarantee_these"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@do_guarantee_these"></a>How do we guarantee that these Tweet objects are immutable – that, once a tweet is created, its author, message, and date can never be changed?</p>

<p id="@first_threat_immutability"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@first_threat_immutability"></a>The first threat to immutability comes from the fact that clients can — in fact must — directly access its fields. So nothing’s stopping us from writing code like this:</p>

<pre id="@let_t_tweet"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@let_t_tweet"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">let</span> t: Tweet = <span class="hljs-keyword">new</span> Tweet(<span class="hljs-string">"justinbieber"</span>,
                    <span class="hljs-string">"Thanks to all those beliebers out there inspiring me every day"</span>,
                    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
t.author = <span class="hljs-string">"rbmllr"</span>;</code></pre>

<p id="@trivial_example_representation"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@trivial_example_representation"></a>This is a trivial example of <mark data-structure-text="representation exposure" id="^representation_exposure"><strong>representation exposure</strong></mark>, meaning that code outside the class can modify the representation directly. Rep exposure like this threatens not only invariants, but also <a href="https://web.mit.edu/6.102/www/sp25/classes/06-abstract-data-types/#representation_independence">representation independence</a>.
We can’t change the implementation of Tweet without affecting all the clients who are directly accessing those fields.</p>

<p id="@fortunately_typescript_gives"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@fortunately_typescript_gives"></a>Fortunately, TypeScript gives us language mechanisms to deal with this kind of rep exposure:</p>

<pre id="@class_tweet_private"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_tweet_private"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> Tweet {

    <span class="hljs-keyword">private</span> readonly author: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">private</span> readonly text: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">private</span> readonly timestamp: <span class="hljs-built_in">Date</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">author: <span class="hljs-built_in">string</span>, text: <span class="hljs-built_in">string</span>, timestamp: <span class="hljs-built_in">Date</span></span>) {
        <span class="hljs-keyword">this</span>.author = author;
        <span class="hljs-keyword">this</span>.text = text;
        <span class="hljs-keyword">this</span>.timestamp = timestamp;
    }

    <span class="hljs-comment">/**
     * @returns Twitter user who wrote the tweet
     */</span>
    <span class="hljs-keyword">public</span> getAuthor(): <span class="hljs-built_in">string</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.author;
    }

    <span class="hljs-comment">/**
     * @returns text of the tweet
     */</span>
    <span class="hljs-keyword">public</span> getText(): <span class="hljs-built_in">string</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.text;
    }

    <span class="hljs-comment">/**
     * @returns date/time when the tweet was sent
     */</span>
    <span class="hljs-keyword">public</span> getTimestamp(): <span class="hljs-built_in">Date</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.timestamp;
    }

}</code></pre>

<p id="@private_public_keywords"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@private_public_keywords"></a>The <code>private</code> and <code>public</code> keywords indicate which fields and methods are accessible only within the class and which can be accessed from outside the class.
<a href="https://www.typescriptlang.org/docs/handbook/2/classes.html#private"><strong><code>private</code></strong></a> is used for the object’s internal state and internal helper methods, while <a href="https://www.typescriptlang.org/docs/handbook/2/classes.html#public"><strong><code>public</code></strong></a> indicates methods and constructors that are intended for clients of the class.
The observers <code>getAuthor()</code>, <code>getText()</code>, and <code>getTimestamp()</code> allow clients to still access a Tweet object’s properties.</p>

<span id="readonly"></span>

<p id="@readonly_used_indicate"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@readonly_used_indicate"></a><mark data-structure-text="readonly" id="^readonly"><a href="https://www.typescriptlang.org/docs/handbook/2/classes.html#readonly"><strong><code>readonly</code></strong></a></mark> is used to indicate which of the object’s instance variables can be reassigned and which can’t.
Note that TypeScript uses <code>readonly</code> only for instance variables, and <code>const</code> only for local and global variables, but both <code>readonly</code> and <code>const</code> mean the same thing: unreassignable.</p>

<div class="panel panel-figure pull-right pull-margin"><object data="./RepInvariants_files/retweetLater.svg" alt="retweetLater breaking Tweet&#39;s immutability"></object></div>

<span id="rep-exposure-by-returning-mutable-object"></span>

<p id="@but_that-s_not"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@but_that-s_not"></a>But that’s not the end of the story: the rep is still exposed! Consider this perfectly reasonable client code that uses <code>Tweet</code>:</p>

<pre id="@returns_tweet_retweets"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@returns_tweet_retweets"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * @returns a tweet that retweets t, one hour later
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retweetLater</span>(<span class="hljs-params">t: Tweet</span>): <span class="hljs-title">Tweet</span> </span>{
    <span class="hljs-keyword">const</span> d: <span class="hljs-built_in">Date</span> = t.getTimestamp();
    d.setHours(d.getHours()+<span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Tweet(<span class="hljs-string">"rbmllr"</span>, t.getText(), d);
}</code></pre>

<p id="@retweetlater_takes_tweet"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@retweetlater_takes_tweet"></a><code>retweetLater</code> takes a tweet and should return another tweet with the same message (called a <em>retweet</em>) but sent an hour later. The <code>retweetLater</code> method might be part of a system that automatically echoes funny things that Twitter celebrities say.</p>

<p id="@what-s_problem_here"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@what-s_problem_here"></a>What’s the problem here? The <code>getTimestamp</code> call returns a reference to the same <code>Date</code> object referenced by tweet <code>t</code>.
<code>t.timestamp</code> and <code>d</code> are aliases to the same mutable object. So when that date object is mutated by <code>d.setHours()</code>, this affects the date in <code>t</code> as well, as shown in the snapshot diagram.</p>

<p id="@tweet-s_immutability_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@tweet-s_immutability_invariant"></a><code>Tweet</code>’s immutability invariant has been broken. The problem is that <code>Tweet</code> leaked out a reference to a mutable object that its immutability depended on. We exposed the rep, in such a way that <code>Tweet</code> can no longer guarantee that its objects are immutable. Perfectly reasonable client code created a subtle bug.</p>

<p id="@can_patch_kind"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@can_patch_kind"></a>We can patch this kind of rep exposure by using defensive copying, a <a href="https://web.mit.edu/6.102/www/sp25/classes/05-designing-specs/#^defensive_copy">strategy we’ve seen before</a>: making a copy of a mutable object to avoid leaking out references to the rep. Here’s the code:</p>

<pre id="@public_gettimestamp_date"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@public_gettimestamp_date"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">public</span> getTimestamp(): <span class="hljs-built_in">Date</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.timestamp.getTime());
}</code></pre>

<p id="@mutable_types_often"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@mutable_types_often"></a>Mutable types often have a copy constructor that allows you to make a new instance that duplicates the value of an existing instance.
In this case, <code>Date</code>’s copy constructor uses the timestamp value, measured in milliseconds since January 1, 1970. As another example, <code>Map</code>’s copy constructor takes an array of key-value pairs, which can be extracted from the map you want to copy by calling <code>entries()</code>.</p>

<div class="panel panel-figure pull-right pull-margin"><object data="./RepInvariants_files/tweetEveryHourToday.svg" alt="tweetEveryHourToday breaking Tweet&#39;s immutability"></object></div>

<p id="@so_we-ve_done"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@so_we-ve_done"></a>So we’ve done some defensive copying in the return value of <code>getTimestamp</code>.
But we’re not done yet! There’s still rep exposure. Consider this (again perfectly reasonable) client code:</p>

<pre id="@returns_array_24"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@returns_array_24"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * @returns an array of 24 inspiring tweets, one per hour today
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tweetEveryHourToday</span>(<span class="hljs-params"></span>): <span class="hljs-title">Array</span>&lt;<span class="hljs-title">Tweet</span>&gt; </span>{
    <span class="hljs-keyword">const</span> array: <span class="hljs-built_in">Array</span>&lt;Tweet&gt; = [];
    <span class="hljs-keyword">const</span> date: <span class="hljs-built_in">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">24</span>; i++) {
        date.setHours(i);
        array.push(<span class="hljs-keyword">new</span> Tweet(<span class="hljs-string">"rbmllr"</span>, <span class="hljs-string">"keep it up! you can do it"</span>, date));
    }
    <span class="hljs-keyword">return</span> array;
}</code></pre>

<p id="@code_intends_advance"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@code_intends_advance"></a>This code intends to advance a single <code>Date</code> object through the 24 hours of a day, creating a tweet for every hour.
But notice that the constructor of Tweet saves the reference that was passed in, so all 24 Tweet objects end up with the same time, as shown in this snapshot diagram.</p>

<p id="@again_immutability_tweet"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@again_immutability_tweet"></a>Again, the immutability of Tweet has been violated. We can fix this problem, too, by using judicious defensive copying, this time in the constructor:</p>

<pre id="@public_constructor-author_string"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@public_constructor-author_string"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">author: <span class="hljs-built_in">string</span>, text: <span class="hljs-built_in">string</span>, timestamp: <span class="hljs-built_in">Date</span></span>) {
    <span class="hljs-keyword">this</span>.author = author;
    <span class="hljs-keyword">this</span>.text = text;
    <span class="hljs-keyword">this</span>.timestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(timestamp.getTime());
}</code></pre>

<p id="@general_you_should"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@general_you_should"></a>In general, you should <strong>carefully</strong> inspect the argument types and return types of all your ADT operations.
If any of the types are mutable, make sure your implementation doesn’t return direct references to its representation.
<strong>Returning a reference to a mutable rep object causes rep exposure.</strong></p>

<p id="@you_may_object"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@you_may_object"></a>You may object that this seems wasteful. Why make all these copies of dates? Why can’t we just solve this problem by a carefully written specification, like this?</p>

<pre id="@make_tweet_param"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@make_tweet_param"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * Make a Tweet.
 * @param author    Twitter user who wrote the tweet
 * @param text      text of the tweet
 * @param timestamp date/time when the tweet was sent. Caller must never
 *                   mutate this Date object again!
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">author: <span class="hljs-built_in">string</span>, text: <span class="hljs-built_in">string</span>, timestamp: <span class="hljs-built_in">Date</span></span>) {</code></pre>

<p id="@approach_sometimes_taken"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@approach_sometimes_taken"></a>This approach is sometimes taken when there isn’t any other reasonable alternative – for example, when the mutable object is too large to copy efficiently. But the cost in your ability to reason about the program, and your ability to avoid bugs, is enormous.
In the absence of compelling arguments to the contrary, it’s almost always worth it for an abstract data type to guarantee its own invariants, and preventing rep exposure is essential to that.
We used <a href="https://web.mit.edu/6.102/www/sp25/classes/05-designing-specs/#lifetime-contract">similar reasoning</a> when we talked about designing specifications as well.</p>

<p id="@even_better_solution"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@even_better_solution"></a>An even better solution is to prefer immutable types.
If <code>Date</code> were an immutable type, then we would have ended this section after talking about <code>public</code> and <code>private</code>.
No further rep exposure would have been possible.</p>

<div class="reading-exercises exercises panel-group converted" id="ex-invariants_2"><h4 class="text-danger" id="@reading_exercises_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_1"></a>reading exercises</h4><p id="@given"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@given"></a>Given:</p>

<pre id="@class_zoo_private"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_zoo_private"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> Zoo {
    <span class="hljs-keyword">private</span> animals: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">animals: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) {
        <span class="hljs-keyword">this</span>.animals = animals;
    }

    <span class="hljs-keyword">public</span> getAnimals(): <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.animals;
    }
}</code></pre>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-invariants_2-aliasing_1" data-target="#ex-invariants_2-aliasing_1" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-invariants_2-aliasing_1"></a><span class="panel-title">Aliasing 1</span></div><div class="panel-collapse collapse exercise-panel" id="ex-invariants_2-aliasing_1" data-outline="aliasing_1" data-ex-id="immutability/aliasing_1" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@output_code"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@output_code"></a>What is the output from this code?</p>

<pre id="@let_array-string_a-push-lion"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@let_array-string_a-push-lion"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">let</span> a: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];
a.push(<span class="hljs-string">"lion"</span>, <span class="hljs-string">"tiger"</span>, <span class="hljs-string">"bear"</span>);
<span class="hljs-keyword">let</span> zoo = <span class="hljs-keyword">new</span> Zoo(a);
a.push(<span class="hljs-string">"zebra"</span>);
<span class="hljs-built_in">console</span>.log(a);
<span class="hljs-built_in">console</span>.log(zoo.getAnimals());</code></pre>

<div class="form-group exercise-part" data-outline="a"><div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;][&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;]"><label for="md_converted_choice_8_0"><input type="radio" id="md_converted_choice_8_0" name="md_converted_radio_8"><code>["lion", "tiger", "bear", "zebra"]</code><br><code>["lion", "tiger", "bear", "zebra"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;][&quot;zebra&quot;, &quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;]"><label for="md_converted_choice_8_1"><input type="radio" id="md_converted_choice_8_1" name="md_converted_radio_8"><code>["lion", "tiger", "bear", "zebra"]</code><br><code>["zebra", "lion", "tiger", "bear", "zebra"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;][&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;]"><label for="md_converted_choice_8_2"><input type="radio" id="md_converted_choice_8_2" name="md_converted_radio_8"><code>["lion", "tiger", "bear"]</code><br><code>["lion", "tiger", "bear", "zebra"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;][&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;]"><label for="md_converted_choice_8_3"><input type="radio" id="md_converted_choice_8_3" name="md_converted_radio_8"><code>["lion", "tiger", "bear", "zebra"]</code><br><code>["lion", "tiger", "bear"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-invariants_2-aliasing_2" data-target="#ex-invariants_2-aliasing_2" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-invariants_2-aliasing_2"></a><span class="panel-title">Aliasing 2</span></div><div class="panel-collapse collapse exercise-panel" id="ex-invariants_2-aliasing_2" data-outline="aliasing_2" data-ex-id="immutability/aliasing_2" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@continuing_same_program"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@continuing_same_program"></a>Continuing in the same program, what is the output?</p>

<pre id="@let_b_zoo-getanimals"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@let_b_zoo-getanimals"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">let</span> b = zoo.getAnimals();
b.push(<span class="hljs-string">"flamingo"</span>);
<span class="hljs-built_in">console</span>.log(a);</code></pre>

<div class="form-group exercise-part" data-outline="a"><div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;]"><label for="md_converted_choice_9_0"><input type="radio" id="md_converted_choice_9_0" name="md_converted_radio_9"><code>["lion", "tiger", "bear"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;]"><label for="md_converted_choice_9_1"><input type="radio" id="md_converted_choice_9_1" name="md_converted_radio_9"><code>["lion", "tiger", "bear", "zebra"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;zebra&quot;, &quot;flamingo&quot;]"><label for="md_converted_choice_9_2"><input type="radio" id="md_converted_choice_9_2" name="md_converted_radio_9"><code>["lion", "tiger", "bear", "zebra", "flamingo"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="[&quot;lion&quot;, &quot;tiger&quot;, &quot;bear&quot;, &quot;flamingo&quot;]"><label for="md_converted_choice_9_3"><input type="radio" id="md_converted_choice_9_3" name="md_converted_radio_9"><code>["lion", "tiger", "bear", "flamingo"]</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-invariants_2-rep_exposure" data-target="#ex-invariants_2-rep_exposure" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-invariants_2-rep_exposure"></a><span class="panel-title">Rep exposure</span></div><div class="panel-collapse collapse exercise-panel" id="ex-invariants_2-rep_exposure" data-outline="rep_exposure" data-ex-id="immutability/rep_exposure" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@consider_following_problematic"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@consider_following_problematic"></a>Consider the following problematic data type:</p>

<pre id="@represents_immutable_right_triangle_class_righttriangle_private_sides_array-number"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@represents_immutable_right_triangle_class_righttriangle_private_sides_array-number"></a><code class="language-ts hljs typescript">      <span class="hljs-comment">/** Represents an immutable right triangle. */</span>
      <span class="hljs-keyword">class</span> RightTriangle {
<span class="hljs-comment">/*A*/</span>     <span class="hljs-keyword">private</span> sides: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;;

<span class="hljs-comment">/*B*/</span>     <span class="hljs-keyword">public</span> readonly hypotenuse: <span class="hljs-built_in">number</span>;

          <span class="hljs-comment">/**
           * Make a right triangle.
           * @param legA, legB  the two legs of the triangle
           * @param hypotenuse  the hypotenuse of the triangle,
*C*        *           requires hypotenuse^2 = legA^2 + legB^2
           *           (within the error tolerance of double arithmetic)
           */</span>
          <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">legA: <span class="hljs-built_in">number</span>, legB: <span class="hljs-built_in">number</span>, hypotenuse: <span class="hljs-built_in">number</span></span>) {
<span class="hljs-comment">/*D*/</span>         <span class="hljs-keyword">this</span>.sides = [ legA, legB ];
<span class="hljs-comment">/*D*/</span>         <span class="hljs-keyword">this</span>.hypotenuse = hypotenuse;
          }

          <span class="hljs-comment">/**
           * Get the two sides of the right triangle.
           * @returns two-element array with the triangle's side lengths
           */</span>
          <span class="hljs-keyword">public</span> getAllSides(): <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; {
<span class="hljs-comment">/*E*/</span>         <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sides;
          }

          <span class="hljs-comment">/**
           * @param factor to multiply the sides by
           * @returns a triangle made from this triangle by
           * multiplying all side lengths by factor.
           */</span>
          <span class="hljs-keyword">public</span> scale(factor: <span class="hljs-built_in">number</span>): RightTriangle {
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RightTriangle(<span class="hljs-keyword">this</span>.sides[<span class="hljs-number">0</span>]*factor, <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">1</span>]*factor, <span class="hljs-keyword">this</span>.hypotenuse*factor);
          }

          <span class="hljs-comment">/**
           * @returns a regular triangle made from this triangle.
           * A regular right triangle is one in which
           * both legs have the same length.
           */</span>
          <span class="hljs-keyword">public</span> regularize(): RightTriangle {
              <span class="hljs-keyword">const</span> bigLeg: <span class="hljs-built_in">number</span> = <span class="hljs-built_in">Math</span>.max(<span class="hljs-keyword">this</span>.sides[<span class="hljs-number">0</span>], <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">1</span>]);
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RightTriangle(bigLeg, bigLeg, <span class="hljs-keyword">this</span>.hypotenuse);
          }

      }</code></pre>

<label class="exercise-part-heading" id="@which_following_statements"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_statements"></a>Which of the following statements are true?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="The line marked /*A*/ is a problem for rep exposure because arrays are mutable."><label for="md_converted_choice_2_0"><input type="checkbox" id="md_converted_choice_2_0">The line marked <code>/*A*/</code> is a problem for rep exposure because arrays are mutable.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="b"><div class="checkbox exercise-choice" data-outline="The line marked /*B*/ is a problem for representation independence because it makes clients dependent on the rep."><label for="md_converted_choice_3_0"><input type="checkbox" id="md_converted_choice_3_0">The line marked <code>/*B*/</code> is a problem for representation independence because it makes clients dependent on the rep.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="c"><div class="checkbox exercise-choice" data-outline="The line marked *C* is a problem because creator operations should not have preconditions."><label for="md_converted_choice_4_0"><input type="checkbox" id="md_converted_choice_4_0">The line marked <code>*C*</code> is a problem because creator operations should not have preconditions.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="d"><div class="checkbox exercise-choice" data-outline="The two lines marked /*D*/ are a problem because they put legA, legB, and hypotenuse into the rep without doing a defensive copy first."><label for="md_converted_choice_5_0"><input type="checkbox" id="md_converted_choice_5_0">The two lines marked <code>/*D*/</code> are a problem because they put legA, legB, and hypotenuse into the rep without doing a defensive copy first.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="e"><div class="checkbox exercise-choice" data-outline="The line marked /*E*/ is a problem because it threatens the class’s immutability."><label for="md_converted_choice_6_0"><input type="checkbox" id="md_converted_choice_6_0">The line marked <code>/*E*/</code> is a problem because it threatens the class’s immutability.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-invariants_2-sign_here" data-target="#ex-invariants_2-sign_here" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-invariants_2-sign_here"></a><span class="panel-title">Sign here</span></div><div class="panel-collapse collapse exercise-panel" id="ex-invariants_2-sign_here" data-outline="sign_here" data-ex-id="immutability/sign_here" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@suppose_you_want"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@suppose_you_want"></a>Suppose you want to build a version of TypeScript where users can choose to only use classes that have been cryptographically signed by identities they trust.
You want each class to manage its own array of signatures, so you provide the operation:</p>

<pre id="@public_getsigners_array-identity"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@public_getsigners_array-identity"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">public</span> getSigners(): <span class="hljs-built_in">Array</span>&lt;Identity&gt;</code></pre>

<p id="@implement_simply_returning"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@implement_simply_returning"></a>and implement it by simply returning a reference to your <code>private Array&lt;Identity&gt;</code> field of identities whose signatures you’ve all checked and validated.</p>

<p id="@which_bugs_do"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_bugs_do"></a>Which bugs do you have?</p>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="the client can append more identities to the array"><label for="md_converted_choice_7_0"><input type="checkbox" id="md_converted_choice_7_0">the client can append more identities to the array</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="the client can replace identities in the array with different ones"><label for="md_converted_choice_7_1"><input type="checkbox" id="md_converted_choice_7_1">the client can replace identities in the array with different ones</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="the client can reassign that field to a different array"><label for="md_converted_choice_7_2"><input type="checkbox" id="md_converted_choice_7_2">the client can reassign that field to a different array</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="the client can break a security-related invariant"><label for="md_converted_choice_7_3"><input type="checkbox" id="md_converted_choice_7_3">the client can break a security-related invariant</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

<p id="@although_signed_classes"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@although_signed_classes"></a>Although the signed classes in the previous exercise don’t actually exist in JavaScript/TypeScript, they are indeed a feature of Java, and would you believe it: <a href="https://bugs.openjdk.java.net/browse/JDK-4048143">Java 1.1 had precisely this security bug</a>.
The fix was to return a copy of the array.</p>

</div></div><h2 id="rep_invariant_and_abstraction_function"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#rep_invariant_and_abstraction_function"></a>Rep invariant and abstraction function</h2><div data-outline="rep_invariant_and_abstraction_function">

<p id="@now_take_deeper"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@now_take_deeper"></a>We now take a deeper look at the theory underlying abstract data types. This theory is not only elegant and interesting in its own right; it also has immediate practical application to the design and implementation of abstract types. If you understand the theory deeply, you’ll be able to build better abstract types, and will be less likely to fall into subtle traps.</p>

<p id="@thinking_about_abstract"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@thinking_about_abstract"></a>In thinking about an abstract type, it helps to consider the relationship between two spaces of values.</p>

<p id="@space_abstract_values"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@space_abstract_values"></a>The space of <em>abstract values</em> consists of the values that the type is designed to support, from the client’s point of view.
For example, an abstract type for unbounded integers, like TypeScript’s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt"><code>BigInt</code></a>, would have the mathematical integers as its abstract value space.</p>

<p id="@space_representation_values"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@space_representation_values"></a>The space of <em>representation values</em> (or rep values for short) consists of the objects that actually implement the abstract values.
For example, a <code>BigInt</code> value might be implemented using an array of digits, represented as <code>number</code> values.
The rep space would then be the set of all such arrays.</p>

<p id="@simple_cases_abstract"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@simple_cases_abstract"></a>In simple cases, an abstract type will be implemented as a single object, but more commonly a small network of objects is needed.
For example, a rep value for <code>Array</code> might possibly be a linked list, a group of objects linked together by next and previous pointers.
So a rep value is not necessarily a single object, but often something rather complicated.</p>

<p id="@now_course_implementer"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@now_course_implementer"></a>Now of course the implementer of the abstract type must be interested in the representation values, since it is the implementer’s job to achieve the illusion of the abstract value space using the rep value space.</p>

<p id="@suppose_example_choose"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@suppose_example_choose"></a>Suppose, for example, that we choose to use a string to represent a set of characters:</p>

<pre id="@class_charset_private_s_string_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_private_s_string_0"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    ...
}</code></pre>

<div class="panel panel-figure pull-right pull-margin"><img src="./RepInvariants_files/charset-af-ri.svg" alt="the abstract space and rep space of CharSet" width="400"></div>

<p id="@then_rep_space"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@then_rep_space"></a>Then the rep space R contains strings, and the abstract space A is mathematical sets of characters.
We can show the two value spaces graphically, with an arrow from a rep value to the abstract value it represents.
There are several things to note about this picture:</p>

<ul id="@every_abstract_value">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@every_abstract_value"></a><strong>Every abstract value has some rep value that maps to it</strong>. The purpose of implementing the abstract type is to support operations on abstract values. Presumably, then, we will need to be able to create and manipulate all possible abstract values, and they must therefore be representable.</li>
<li><strong>Multiple rep values can map to the same abstract value</strong>. This happens because the representation isn’t a tight encoding. There’s more than one way to represent an unordered set of characters as a string.</li>
<li><strong>Not all rep values map to an abstract value</strong>. In this case, the string “abbc” doesn’t map to anything, because we have decided that the rep string should not contain duplicates. This will allow us to terminate the <code>remove</code> method when we hit the first instance of a particular character, since we know there can be at most one.</li>
</ul>

<div class="clearfix"></div>

<p id="@practice_can_only"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@practice_can_only"></a>In practice, we can only illustrate a few elements of the two spaces and their relationships; the graph as a whole is infinite. So we describe it by giving two things:</p>

<p id="@1_abstraction_function"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@1_abstraction_function"></a>1.  An <mark data-mark-text="abstraction function (AF)" data-structure-text="abstraction function (AF)" id="^abstraction_function_af"><em>abstraction function</em></mark> that maps rep values to the abstract values they represent:</p>

<blockquote>
  <p id="@af_r"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af_r"></a>AF : R → A</p>
</blockquote>

<p id="@arrows_diagram_above"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@arrows_diagram_above"></a>The arrows in the diagram above show the abstraction function. In the terminology of functions, the properties we discussed above can be expressed by saying that the function is <a href="https://en.wikipedia.org/wiki/Surjective_function">surjective</a> (also called <em>onto</em>), not necessarily <a href="https://en.wikipedia.org/wiki/Injective_function">injective</a> (<em>one-to-one</em>) and therefore not necessarily <a href="https://en.wikipedia.org/wiki/Bijection">bijective</a>, and often <a href="https://en.wikipedia.org/wiki/Partial_function">partial</a>.</p>

<span id="rep-invariant"></span>

<p id="@2_rep_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@2_rep_invariant"></a>2.  A <mark data-mark-text="representation invariant (RI)" data-structure-text="representation invariant (RI)" id="^representation_invariant_ri"><em>rep invariant</em></mark> that maps rep values to booleans:</p>

<blockquote>
  <p id="@ri_r_boolean"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ri_r_boolean"></a>RI : R → boolean</p>
</blockquote>

<p id="@rep_invariant_predicate"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_invariant_predicate"></a>A rep invariant is a <a href="https://en.wikipedia.org/wiki/Boolean-valued_function">predicate</a> over rep values.</p>

<p id="@rep_value_r"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_value_r"></a>For a rep value <em>r</em>, <em>RI(r)</em> is true if and only if <em>r</em> is mapped by <em>AF</em>. In other words, <em>RI</em> tells us whether a given rep value is well-formed.
Alternatively, you can think of <em>RI</em> as a set: it’s the subset of rep values on which <em>AF</em> is defined.</p>

<div class="panel panel-figure pull-right pull-margin"><img src="./RepInvariants_files/charset-norepeats.svg" alt="the abstract space and rep space of CharSet using the NoRepeatsRep" width="400"></div>

<p id="@example_diagram_right"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@example_diagram_right"></a>For example, the diagram at the right showing a rep for CharSet that forbids repeated characters:</p>

<ul id="@ri-a_true_ri-ac">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ri-a_true_ri-ac"></a><em>RI(“a”)</em> = true</li>
<li><em>RI(“ac”)</em> = true </li>
<li><em>RI(“acb”)</em> = true</li>
</ul>

<p id="@but_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@but_1"></a>but</p>

<ul id="@ri-aa_false_ri-abbc">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ri-aa_false_ri-abbc"></a><em>RI(“aa”)</em> = false</li>
<li><em>RI(“abbc”)</em> = false</li>
</ul>

<p id="@rep_values_obey"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_values_obey"></a>Rep values that obey the rep invariant are shown in the green part of the R space, and must map to an abstract value in the A space.
Rep values that violate the rep invariant are shown in the red zone, and have no equivalent abstract value in the A space.</p>

<p id="@both_rep_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@both_rep_invariant"></a>Both the rep invariant and the abstraction function should be documented in the code, right next to the declaration of the rep itself:</p>

<pre id="@class_charset_private_s_string_rep_invariant_s_contains"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_private_s_string_rep_invariant_s_contains"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   s contains no repeated characters</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
    ...
}</code></pre>

<div class="clearfix"></div>

<p id="@common_confusion_about"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@common_confusion_about"></a>A common confusion about abstraction functions and rep invariants is that they are determined by the choice of rep and abstract value spaces, or even by the abstract value space alone. If this were the case, they would be of little use, since they would be saying something redundant that’s already available elsewhere.</p>

<p id="@abstract_value_space"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@abstract_value_space"></a>The abstract value space alone doesn’t determine AF or RI: there can be several representations for the same abstract type. A set of characters could equally be represented as a string, as above, or as a bit vector, with one bit for each possible character. Clearly we need two different abstraction functions to map these two different rep value spaces.</p>

<p id="@less_obvious_why"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@less_obvious_why"></a>It’s less obvious why the choice of both spaces doesn’t determine AF and RI. The key point is that defining a type for the rep, and thus choosing the values for the space of rep values, does not determine which of the rep values will be deemed to be legal, and of those that are legal, how they will be interpreted. Rather than deciding, as we did above, that the strings have no duplicates, we could instead allow duplicates, but at the same time require that the characters be sorted, appearing in nondecreasing order. This would allow us to perform a binary search on the string and thus check membership in logarithmic rather than linear time. Same rep value space – different rep invariant:</p>

<div class="panel panel-figure pull-right pull-margin"><img src="./RepInvariants_files/charset-sorted.svg" alt="the abstract space and rep space of CharSet using the SortedRep" width="400"></div>

<pre id="@class_charset_private_s_string_rep_invariant_s-0_s-1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_private_s_string_rep_invariant_s-0_s-1"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
    ...
}</code></pre>

<span class="clearfix"></span>

<p id="@even_same_type"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@even_same_type"></a>Even with the same type for the rep value space and the same rep invariant, we might still interpret the rep differently by using different abstraction functions.
Suppose the rep invariant admits any string of characters.
Then we could define the abstraction function, as above, to interpret the array’s elements as the elements of the set.
But there’s no <em>a priori</em> reason to let the rep decide the interpretation.
Perhaps we’ll interpret consecutive pairs of characters as subranges, so that the string rep <code>"acgg"</code> is interpreted as two range pairs, [a-c] and [g-g], and therefore represents the set {a,b,c,g}.
Here’s what the AF and RI would look like for that representation:</p>

<div class="panel panel-figure pull-right pull-margin"><img src="./RepInvariants_files/charset-sortedrange.png" alt="the abstract space and rep space of CharSet using the SortedRangeRep" width="400"></div>

<pre id="@class_charset_private_string_s_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_private_string_s_rep"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> s;
    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(s) = union of { c | s[2i] &lt;= c &lt;= s[2i+1] }</span>
    <span class="hljs-comment">//           for all 0 &lt;= i &lt; s.length/2</span>
    ...
}</code></pre>

<p id="@does_abstraction_function"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@does_abstraction_function"></a>(What does this abstraction function do when <code>s.length</code> is odd, i.e. when there is an unpaired character at the end of the string?)</p>

<span class="clearfix"></span>

<p id="@essential_point_implementing"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@essential_point_implementing"></a>The essential point is that implementing an abstract type means <strong>not only choosing the two spaces</strong> – the abstract value space for the specification and the rep value space for the implementation – <strong>but also deciding which rep values are legal, and how to interpret them as abstract values</strong>.</p>

<p id="@critically_important_write"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@critically_important_write"></a>It’s critically important to write down these assumptions in your code, as we’ve done above, so that future programmers (and your future self) are aware of what the representation actually means.  Why? What happens if different implementers disagree about the meaning of the rep?</p>

<div class="handout-solo alert alert-warning"><p id="@you_can_look_example_code_three"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@you_can_look_example_code_three"></a>You can look at example code for <a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/code.html#charsetts" class="alert-link">three different <code>CharSet</code> implementations</a>.</p></div>

<div class="reading-exercises exercises panel-group converted" id="ex-rep_invariant_and_abstraction_function"><h4 class="text-danger" id="@reading_exercises_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_2"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function-exploring_a_rep" data-target="#ex-rep_invariant_and_abstraction_function-exploring_a_rep" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function-exploring_a_rep"></a><span class="panel-title">Exploring a rep</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function-exploring_a_rep" data-outline="exploring_a_rep" data-ex-id="rep_invariant_and_abstraction_function/exploring_a_rep" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@consider_last_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@consider_last_rep"></a>Consider the last rep for <code>CharSet</code> proposed above:</p>

<pre id="@class_charset_private_s_string_rep_invariant_s-length_even"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_private_s_string_rep_invariant_s-length_even"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   s.length is even</span>
    <span class="hljs-comment">//   s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(s) = union of { c | s[2i] &lt;= c &lt;= s[2i+1] }</span>
    <span class="hljs-comment">//           for all 0 &lt;= i &lt; s.length/2</span>
    ...
}</code></pre>

<label class="exercise-part-heading" id="@which_following_values"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_values"></a>Which of the following values of <code>s</code> satisfy this rep invariant?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="&quot;abc&quot;"><label for="md_converted_choice_10_0"><input type="checkbox" id="md_converted_choice_10_0"><code>"abc"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="&quot;abcd&quot;"><label for="md_converted_choice_10_1"><input type="checkbox" id="md_converted_choice_10_1"><code>"abcd"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="&quot;eeee&quot;"><label for="md_converted_choice_10_2"><input type="checkbox" id="md_converted_choice_10_2"><code>"eeee"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="&quot;ad&quot;"><label for="md_converted_choice_10_3"><input type="checkbox" id="md_converted_choice_10_3"><code>"ad"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="&quot;adad&quot;"><label for="md_converted_choice_10_4"><input type="checkbox" id="md_converted_choice_10_4"><code>"adad"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="&quot;&quot;"><label for="md_converted_choice_10_5"><input type="checkbox" id="md_converted_choice_10_5"><code>""</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<label class="exercise-part-heading" id="@which_following_does"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_does"></a>Which of the following does <code>AF("acfg")</code> map to?</label>

<div class="form-group exercise-part" data-outline="b"><div class="radio exercise-choice" data-outline="{a,b,c,d,e,f,g}"><label for="md_converted_choice_18_0"><input type="radio" id="md_converted_choice_18_0" name="md_converted_radio_18">{a,b,c,d,e,f,g}</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="{a,b,c,f,g}"><label for="md_converted_choice_18_1"><input type="radio" id="md_converted_choice_18_1" name="md_converted_radio_18">{a,b,c,f,g}</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="{a,c,f,g}"><label for="md_converted_choice_18_2"><input type="radio" id="md_converted_choice_18_2" name="md_converted_radio_18">{a,c,f,g}</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="some other abstract value"><label for="md_converted_choice_18_3"><input type="radio" id="md_converted_choice_18_3" name="md_converted_radio_18">some other abstract value</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="no abstract value, because &quot;acfg&quot; does not satisfy the rep invariant"><label for="md_converted_choice_18_4"><input type="radio" id="md_converted_choice_18_4" name="md_converted_radio_18">no abstract value, because <code>"acfg"</code> does not satisfy the rep invariant</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<label class="exercise-part-heading" id="@which_these_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_these_rep"></a>Which of these rep values <code>r</code> have the same abstract value as <code>"tv"</code> — i.e., <code>AF(r) = AF("tv")</code>?</label>

<div class="form-group exercise-part" data-outline="c"><div class="checkbox exercise-choice" data-outline="r = &quot;ttv&quot;"><label for="md_converted_choice_11_0"><input type="checkbox" id="md_converted_choice_11_0"><code>r = "ttv"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="r = &quot;ttuuvv&quot;"><label for="md_converted_choice_11_1"><input type="checkbox" id="md_converted_choice_11_1"><code>r = "ttuuvv"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="r = &quot;ttuv&quot;"><label for="md_converted_choice_11_2"><input type="checkbox" id="md_converted_choice_11_2"><code>r = "ttuv"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="r = &quot;tuv&quot;"><label for="md_converted_choice_11_3"><input type="checkbox" id="md_converted_choice_11_3"><code>r = "tuv"</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function-who_knows_what" data-target="#ex-rep_invariant_and_abstraction_function-who_knows_what" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function-who_knows_what"></a><span class="panel-title">Who knows what?</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function-who_knows_what" data-outline="who_knows_what" data-ex-id="rep_invariant_and_abstraction_function/who_knows_what" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<label class="exercise-part-heading" id="@which_following_should_be_known_visible"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_should_be_known_visible"></a>Which of the following should be known (visible and documented) to the client of an abstract data type?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="abstract value space"><label for="md_converted_choice_12_0"><input type="checkbox" id="md_converted_choice_12_0">abstract value space</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="abstraction function"><label for="md_converted_choice_12_1"><input type="checkbox" id="md_converted_choice_12_1">abstraction function</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="specs of creator operations"><label for="md_converted_choice_12_2"><input type="checkbox" id="md_converted_choice_12_2">specs of creator operations</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="specs of observer operations"><label for="md_converted_choice_12_3"><input type="checkbox" id="md_converted_choice_12_3">specs of observer operations</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="rep"><label for="md_converted_choice_12_4"><input type="checkbox" id="md_converted_choice_12_4">rep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="rep invariant"><label for="md_converted_choice_12_5"><input type="checkbox" id="md_converted_choice_12_5">rep invariant</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<label class="exercise-part-heading" id="@which_following_should_be_known_maintainer"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_should_be_known_maintainer"></a>Which of the following should be known to the maintainer of an abstract data type?</label>

<div class="form-group exercise-part" data-outline="b"><div class="checkbox exercise-choice" data-outline="abstract value space"><label for="md_converted_choice_13_0"><input type="checkbox" id="md_converted_choice_13_0">abstract value space</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="abstraction function"><label for="md_converted_choice_13_1"><input type="checkbox" id="md_converted_choice_13_1">abstraction function</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="specs of creator operations"><label for="md_converted_choice_13_2"><input type="checkbox" id="md_converted_choice_13_2">specs of creator operations</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="specs of observer operations"><label for="md_converted_choice_13_3"><input type="checkbox" id="md_converted_choice_13_3">specs of observer operations</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="rep"><label for="md_converted_choice_13_4"><input type="checkbox" id="md_converted_choice_13_4">rep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="rep invariant"><label for="md_converted_choice_13_5"><input type="checkbox" id="md_converted_choice_13_5">rep invariant</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function-rep_invariant_pieces" data-target="#ex-rep_invariant_and_abstraction_function-rep_invariant_pieces" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function-rep_invariant_pieces"></a><span class="panel-title">Rep invariant pieces</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function-rep_invariant_pieces" data-outline="rep_invariant_pieces" data-ex-id="rep_invariant_and_abstraction_function/rep_invariant_pieces" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@suppose_c_abstract"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@suppose_c_abstract"></a>Suppose <code>C</code> is an abstract data type whose representation has two <code>string</code> fields:</p>

<pre id="@class_c_private"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_c_private"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> C {
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">private</span> t: <span class="hljs-built_in">string</span>;
    ...
}</code></pre>

<label class="exercise-part-heading" id="@assuming_you_don-t"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@assuming_you_don-t"></a>Assuming you don’t know anything about <code>C</code>’s abstraction, which of the following might be among the conditional expressions in a rep invariant for <code>C</code>?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="s contains only letters"><label for="md_converted_choice_14_0"><input type="checkbox" id="md_converted_choice_14_0"><code>s</code> contains only letters</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="s.length === t.length"><label for="md_converted_choice_14_1"><input type="checkbox" id="md_converted_choice_14_1"><code>s.length === t.length</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="s represents a set of characters"><label for="md_converted_choice_14_2"><input type="checkbox" id="md_converted_choice_14_2"><code>s</code> represents a set of characters</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="C’s observers"><label for="md_converted_choice_14_3"><input type="checkbox" id="md_converted_choice_14_3"><code>C</code>’s observers</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="s is the reverse of t"><label for="md_converted_choice_14_4"><input type="checkbox" id="md_converted_choice_14_4"><code>s</code> is the reverse of <code>t</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="s+t"><label for="md_converted_choice_14_5"><input type="checkbox" id="md_converted_choice_14_5"><code>s+t</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri" data-target="#ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri"></a><span class="panel-title">Trying to implement without an AF/RI</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri" data-outline="trying_to_implement_without_an_afri" data-ex-id="rep_invariant_and_abstraction_function/trying_to_implement_without_an_afri" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@suppose_louis_reasoner"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@suppose_louis_reasoner"></a>Suppose Louis Reasoner has created <code>CharSet</code> with the following rep:</p>

<pre id="@class_charset_private_s_string_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_private_s_string_2"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    ...
}</code></pre>

<p id="@but_louis_unfortunately"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@but_louis_unfortunately"></a>But Louis unfortunately neglects to write down the abstraction function (AF) and rep invariant (RI).  Here are four possible AF/RI pairs that <em>might</em> have been what Louis had in mind.  All of them were also mentioned in the reading above.</p>

<p id="@sortedrep_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrep_0"></a>SortedRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_0"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s[0] &lt; s[1] &lt; ... &lt; s[s.length-1]</span></code></pre>

<p id="@sortedrangerep_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrangerep_0"></a>SortedRangeRep:</p>

<pre id="sortedrangerep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#sortedrangerep"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = union of { c | s[2i] &lt;= c &lt;= s[2i+1] }</span>
<span class="hljs-comment">//         for all 0 &lt;= i &lt; s.length/2</span>
<span class="hljs-comment">// RI: s.length is even, and s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span></code></pre>

<p id="@norepeatsrep_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@norepeatsrep_0"></a>NoRepeatsRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_0"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s contains no character more than once</span></code></pre>

<p id="@anyrep_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@anyrep_0"></a>AnyRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_true_0"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_true_0"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: true</span></code></pre>

<p id="@louis_three_teammates"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@louis_three_teammates"></a>Louis has three teammates helping him implement <code>CharSet</code>, each working on a different operation: <code>add()</code>, <code>remove()</code>, and <code>contains()</code>.
Each teammate might have their own idea about what the AF/RI should be.</p>

<label class="exercise-part-heading" id="@which_af-ri_pairs_consistent_implementation_add"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_af-ri_pairs_consistent_implementation_add"></a>Which of the AF/RI pairs are consistent with this implementation of <code>add()</code>?</label>

<div class="panel panel-figure pull-right"><p id="@sortedrep_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrep_1"></a>SortedRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_1"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s[0] &lt; s[1] &lt; ... &lt; s[s.length-1]</span></code></pre>

<p id="@sortedrangerep_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrangerep_1"></a>SortedRangeRep:</p>

<pre id="sortedrangerep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#sortedrangerep"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = union of { c | s[2i] &lt;= c &lt;= s[2i+1] }</span>
<span class="hljs-comment">//         for all 0 &lt;= i &lt; s.length/2</span>
<span class="hljs-comment">// RI: s.length is even, and s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span></code></pre>

<p id="@norepeatsrep_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@norepeatsrep_1"></a>NoRepeatsRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_1"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s contains no character more than once</span></code></pre>

<p id="@anyrep_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@anyrep_1"></a>AnyRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_true_1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_true_1"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: true</span></code></pre></div>

<pre id="@modifies_set_adding"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@modifies_set_adding"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * Modifies this set by adding c to the set.
 * @param c character to add; required to be one-character string.
 */</span>
<span class="hljs-keyword">public</span> add(c: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">this</span>.s = <span class="hljs-keyword">this</span>.s + c;
}</code></pre>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="SortedRep"><label for="md_converted_choice_15_0"><input type="checkbox" id="md_converted_choice_15_0">SortedRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="SortedRangeRep"><label for="md_converted_choice_15_1"><input type="checkbox" id="md_converted_choice_15_1">SortedRangeRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="NoRepeatsRep"><label for="md_converted_choice_15_2"><input type="checkbox" id="md_converted_choice_15_2">NoRepeatsRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="AnyRep"><label for="md_converted_choice_15_3"><input type="checkbox" id="md_converted_choice_15_3">AnyRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="clearfix"></div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_2" data-target="#ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_2" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_2"></a><span class="panel-title">Trying to implement without an AF/RI #2</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_2" data-outline="trying_to_implement_without_an_afri_2" data-ex-id="rep_invariant_and_abstraction_function/trying_to_implement_without_an_afri_2" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<label class="exercise-part-heading" id="@which_af-ri_pairs_consistent_implementation_remove"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_af-ri_pairs_consistent_implementation_remove"></a>Which of the AF/RI pairs are consistent with this implementation of <code>remove()</code>?</label>

<div class="panel panel-figure pull-right"><p id="@sortedrep_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrep_2"></a>SortedRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_2"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s[0] &lt; s[1] &lt; ... &lt; s[s.length-1]</span></code></pre>

<p id="@sortedrangerep_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrangerep_2"></a>SortedRangeRep:</p>

<pre id="sortedrangerep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#sortedrangerep"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = union of { c | s[2i] &lt;= c &lt;= s[2i+1] }</span>
<span class="hljs-comment">//         for all 0 &lt;= i &lt; s.length/2</span>
<span class="hljs-comment">// RI: s.length is even, and s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span></code></pre>

<p id="@norepeatsrep_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@norepeatsrep_2"></a>NoRepeatsRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_2"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s contains no character more than once</span></code></pre>

<p id="@anyrep_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@anyrep_2"></a>AnyRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_true_2"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_true_2"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: true</span></code></pre></div>

<pre id="@modifies_set_removing"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@modifies_set_removing"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * Modifies this set by removing c, if found.
 * If c is not found in the set, has no effect.
 * @param c character to remove; required to be one-character string.
 */</span>
<span class="hljs-keyword">public</span> remove(c: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> position = <span class="hljs-keyword">this</span>.s.indexOf(c);
    <span class="hljs-keyword">if</span> (position &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.s = <span class="hljs-keyword">this</span>.s.substring(<span class="hljs-number">0</span>, position) + <span class="hljs-keyword">this</span>.s.substring(position+<span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.s.length);
    }
}</code></pre>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="SortedRep"><label for="md_converted_choice_16_0"><input type="checkbox" id="md_converted_choice_16_0">SortedRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="SortedRangeRep"><label for="md_converted_choice_16_1"><input type="checkbox" id="md_converted_choice_16_1">SortedRangeRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="NoRepeatsRep"><label for="md_converted_choice_16_2"><input type="checkbox" id="md_converted_choice_16_2">NoRepeatsRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="AnyRep"><label for="md_converted_choice_16_3"><input type="checkbox" id="md_converted_choice_16_3">AnyRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="clearfix"></div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div>

<div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_3" data-target="#ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_3" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_3"></a><span class="panel-title">Trying to implement without an AF/RI #3</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function-trying_to_implement_without_an_afri_3" data-outline="trying_to_implement_without_an_afri_3" data-ex-id="rep_invariant_and_abstraction_function/trying_to_implement_without_an_afri_3" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<label class="exercise-part-heading" id="@which_af-ri_pairs_consistent_implementation_contains"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_af-ri_pairs_consistent_implementation_contains"></a>Which of the AF/RI pairs are consistent with this implementation of <code>contains()</code>?</label>

<div class="panel panel-figure pull-right"><p id="@sortedrep_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrep_3"></a>SortedRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s-0_s-1_s-s-length-1_3"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s[0] &lt; s[1] &lt; ... &lt; s[s.length-1]</span></code></pre>

<p id="@sortedrangerep_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@sortedrangerep_3"></a>SortedRangeRep:</p>

<pre id="sortedrangerep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#sortedrangerep"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = union of { c | s[2i] &lt;= c &lt;= s[2i+1] }</span>
<span class="hljs-comment">//         for all 0 &lt;= i &lt; s.length/2</span>
<span class="hljs-comment">// RI: s.length is even, and s[0] &lt;= s[1] &lt;= ... &lt;= s[s.length-1]</span></code></pre>

<p id="@norepeatsrep_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@norepeatsrep_3"></a>NoRepeatsRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_s_contains_no_character_more_than_once_3"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: s contains no character more than once</span></code></pre>

<p id="@anyrep_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@anyrep_3"></a>AnyRep:</p>

<pre id="@af-s_s-i_0_i_s-length_ri_true_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@af-s_s-i_0_i_s-length_ri_true_3"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</span>
<span class="hljs-comment">// RI: true</span></code></pre></div>

<pre id="@test_membership_param"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@test_membership_param"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * Test for membership.
 * @param c a one-character string.
 * @returns true iff this set contains c
 */</span>
<span class="hljs-keyword">public</span> contains(c: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.s.length; i += <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">const</span> low: <span class="hljs-built_in">string</span> = <span class="hljs-keyword">this</span>.s.charAt(i);
        <span class="hljs-keyword">const</span> high: <span class="hljs-built_in">string</span> = <span class="hljs-keyword">this</span>.s.charAt(i+<span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (low &lt;= c &amp;&amp; c &lt;= high) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}</code></pre>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="SortedRep"><label for="md_converted_choice_17_0"><input type="checkbox" id="md_converted_choice_17_0">SortedRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="SortedRangeRep"><label for="md_converted_choice_17_1"><input type="checkbox" id="md_converted_choice_17_1">SortedRangeRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="NoRepeatsRep"><label for="md_converted_choice_17_2"><input type="checkbox" id="md_converted_choice_17_2">NoRepeatsRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="AnyRep"><label for="md_converted_choice_17_3"><input type="checkbox" id="md_converted_choice_17_3">AnyRep</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="clearfix"></div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

<h3 id="example_rational_numbers"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#example_rational_numbers"></a>Example: rational numbers</h3><div data-outline="example_rational_numbers">

<div class="panel panel-figure pull-right pull-margin"><img src="./RepInvariants_files/ratnum-af-ri.svg" alt="the abstraction function and rep invariant of RatNum" width="600"></div>

<p id="@here-s_example_abstract"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@here-s_example_abstract"></a>Here’s&nbsp;an&nbsp;example&nbsp;of&nbsp;an abstract data type for arbitrary-precision rational numbers, implemented using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt"><code>BigInt</code></a> in the rep.
Look closely at its rep invariant and abstraction function.
It would be completely reasonable to design another implementation of this same ADT with a more permissive RI.
With such a change, some operations might become more expensive to perform, and others cheaper.</p>

<style id="ratnum-code-block" class="no-markdown">
#ratnum-code-block + pre { min-width: 37em; } /* prevent bad wrapping vs. large figure */
</style>

<pre id="@class_ratnum_private_readonly_numerator_bigint"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_ratnum_private_readonly_numerator_bigint"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> RatNum {

    <span class="hljs-keyword">private</span> readonly numerator: bigint;
    <span class="hljs-keyword">private</span> readonly denominator: bigint;

    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   denominator &gt; 0</span>
    <span class="hljs-comment">//   numerator/denominator is in reduced form,</span>
    <span class="hljs-comment">//       i.e. gcd(|numerator|,denominator) = 1</span>

    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(numerator, denominator) = numerator/denominator</span>

    <span class="hljs-comment">/**
     * Make a new RatNum = (n / d).
     * @param n numerator
     * @param d denominator
     * @throws Error if d = 0
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">n: bigint, d: bigint</span>) {
        <span class="hljs-comment">// reduce ratio to lowest terms</span>
        <span class="hljs-keyword">const</span> g = gcd(BigInt(n), BigInt(d));
        <span class="hljs-keyword">const</span> reducedNumerator = n / g;
        <span class="hljs-keyword">const</span> reducedDenominator = d / g;

        <span class="hljs-comment">// make denominator positive</span>
        <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0n</span>) {
            <span class="hljs-keyword">this</span>.numerator = -reducedNumerator;
            <span class="hljs-keyword">this</span>.denominator = -reducedDenominator;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d &gt; <span class="hljs-number">0n</span>) {
            <span class="hljs-keyword">this</span>.numerator = reducedNumerator;
            <span class="hljs-keyword">this</span>.denominator = reducedDenominator;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'denominator is zero'</span>);
        }
        <span class="hljs-keyword">this</span>.checkRep();
    }

}</code></pre>

<p id="@note_bigint_literals"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@note_bigint_literals"></a>(Note that <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt#type_information"><code>bigint</code> literals</a> are integers suffixed with <code>n</code>.)</p>

<div class="reading-exercises exercises panel-group converted" id="ex-rep_invariant_and_abstraction_function_2"><h4 class="text-danger" id="@reading_exercises_3"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_3"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function_2-ratnum" data-target="#ex-rep_invariant_and_abstraction_function_2-ratnum" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function_2-ratnum"></a><span class="panel-title">RatNum</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function_2-ratnum" data-outline="ratnum" data-ex-id="example_rational_numbers/ratnum" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@looking_code_above"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@looking_code_above"></a>Looking at the code above, and the abstraction function diagram next to it, which line of the rep is <em>most responsible</em> for each of these features of the abstraction function diagram?</p>

<p id="@numerator-1_denominator-2_appears"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@numerator-1_denominator-2_appears"></a><code>(numerator=1, denominator=-2)</code> appears in the red zone of R</p>

<div class="form-group exercise-part" data-outline="a"><div class="radio exercise-choice" data-outline="private readonly numerator: bigint;"><label for="md_converted_choice_19_0"><input type="radio" id="md_converted_choice_19_0" name="md_converted_radio_19"><code>private readonly numerator: bigint;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="private readonly denominator: bigint;"><label for="md_converted_choice_19_1"><input type="radio" id="md_converted_choice_19_1" name="md_converted_radio_19"><code>private readonly denominator: bigint;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// Rep invariant:"><label for="md_converted_choice_19_2"><input type="radio" id="md_converted_choice_19_2" name="md_converted_radio_19"><code>// Rep invariant:</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// denominator &gt; 0"><label for="md_converted_choice_19_3"><input type="radio" id="md_converted_choice_19_3" name="md_converted_radio_19"><code>//   denominator &gt; 0</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// numerator/denominator is in reduced form, ..."><label for="md_converted_choice_19_4"><input type="radio" id="md_converted_choice_19_4" name="md_converted_radio_19"><code>//   numerator/denominator is in reduced form, ...</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// Abstraction function:"><label for="md_converted_choice_19_5"><input type="radio" id="md_converted_choice_19_5" name="md_converted_radio_19"><code>// Abstraction function:</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// AF(numerator, denominator) = numerator/denominator"><label for="md_converted_choice_19_6"><input type="radio" id="md_converted_choice_19_6" name="md_converted_radio_19"><code>//   AF(numerator, denominator) = numerator/denominator</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@numerator-2_denominator-4_appears"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@numerator-2_denominator-4_appears"></a><code>(numerator=2, denominator=4)</code> appears in the red zone of R</p>

<div class="form-group exercise-part" data-outline="b"><div class="radio exercise-choice" data-outline="private readonly numerator: bigint;"><label for="md_converted_choice_20_0"><input type="radio" id="md_converted_choice_20_0" name="md_converted_radio_20"><code>private readonly numerator: bigint;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="private readonly denominator: bigint;"><label for="md_converted_choice_20_1"><input type="radio" id="md_converted_choice_20_1" name="md_converted_radio_20"><code>private readonly denominator: bigint;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// Rep invariant:"><label for="md_converted_choice_20_2"><input type="radio" id="md_converted_choice_20_2" name="md_converted_radio_20"><code>// Rep invariant:</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// denominator &gt; 0"><label for="md_converted_choice_20_3"><input type="radio" id="md_converted_choice_20_3" name="md_converted_radio_20"><code>//   denominator &gt; 0</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// numerator/denominator is in reduced form, ..."><label for="md_converted_choice_20_4"><input type="radio" id="md_converted_choice_20_4" name="md_converted_radio_20"><code>//   numerator/denominator is in reduced form, ...</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// Abstraction function:"><label for="md_converted_choice_20_5"><input type="radio" id="md_converted_choice_20_5" name="md_converted_radio_20"><code>// Abstraction function:</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// AF(numerator, denominator) = numerator/denominator"><label for="md_converted_choice_20_6"><input type="radio" id="md_converted_choice_20_6" name="md_converted_radio_20"><code>//   AF(numerator, denominator) = numerator/denominator</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@arrow_goes_numerator-1"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@arrow_goes_numerator-1"></a>an arrow goes from <code>(numerator=-1, denominator=2)</code> to -1/2</p>

<div class="form-group exercise-part" data-outline="c"><div class="radio exercise-choice" data-outline="private readonly numerator: bigint;"><label for="md_converted_choice_21_0"><input type="radio" id="md_converted_choice_21_0" name="md_converted_radio_21"><code>private readonly numerator: bigint;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="private readonly denominator: bigint;"><label for="md_converted_choice_21_1"><input type="radio" id="md_converted_choice_21_1" name="md_converted_radio_21"><code>private readonly denominator: bigint;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// Rep invariant:"><label for="md_converted_choice_21_2"><input type="radio" id="md_converted_choice_21_2" name="md_converted_radio_21"><code>// Rep invariant:</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// denominator &gt; 0"><label for="md_converted_choice_21_3"><input type="radio" id="md_converted_choice_21_3" name="md_converted_radio_21"><code>//   denominator &gt; 0</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// numerator/denominator is in reduced form, ..."><label for="md_converted_choice_21_4"><input type="radio" id="md_converted_choice_21_4" name="md_converted_radio_21"><code>//   numerator/denominator is in reduced form, ...</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// Abstraction function:"><label for="md_converted_choice_21_5"><input type="radio" id="md_converted_choice_21_5" name="md_converted_radio_21"><code>// Abstraction function:</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="// AF(numerator, denominator) = numerator/denominator"><label for="md_converted_choice_21_6"><input type="radio" id="md_converted_choice_21_6" name="md_converted_radio_21"><code>//   AF(numerator, denominator) = numerator/denominator</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

<div class="clearfix"></div>

</div><h3 id="checking_the_rep_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#checking_the_rep_invariant"></a>Checking the rep invariant</h3><div data-outline="checking_the_rep_invariant">

<p id="@rep_invariant_isn-t"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_invariant_isn-t"></a>The rep invariant isn’t just a neat mathematical idea. If your implementation asserts the rep invariant at run time, then you can catch bugs early.  Here’s a method for <code>RatNum</code> that tests its rep invariant:</p>

<pre id="@assert_rep_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@assert_rep_invariant"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// assert the rep invariant</span>
<span class="hljs-keyword">private</span> checkRep(): <span class="hljs-built_in">void</span> {
    assert(<span class="hljs-keyword">this</span>.denominator &gt; <span class="hljs-number">0n</span>);
    assert(gcd(abs(<span class="hljs-keyword">this</span>.numerator), <span class="hljs-keyword">this</span>.denominator) === <span class="hljs-number">1n</span>);
}</code></pre>

<p id="@you_should_certainly"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@you_should_certainly"></a>You should certainly call <code>checkRep()</code> to assert the rep invariant at the end of every operation that creates or mutates the rep – in other words, creators, producers, and mutators.  Look back at the <code>RatNum</code> code above, and you’ll see that it calls <code>checkRep()</code> at the end of the constructor.</p>

<p id="@observer_methods_don-t"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@observer_methods_don-t"></a>Observer methods don’t normally need to call <code>checkRep()</code>, but it’s good defensive practice to do so anyway.  Why? Calling <code>checkRep()</code> in every method, including observers, means you’ll be more likely to catch rep invariant violations caused by rep exposure.</p>

<p id="@why_checkrep_private"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@why_checkrep_private"></a>Why is <code>checkRep</code> private?  Who should be responsible for checking and enforcing a rep invariant – clients, or the implementation itself?</p>

<div class="reading-exercises exercises panel-group converted" id="ex-rep_invariant_and_abstraction_function_3"><h4 class="text-danger" id="@reading_exercises_4"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_4"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function_3-checking_the_rep_invariant" data-target="#ex-rep_invariant_and_abstraction_function_3-checking_the_rep_invariant" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function_3-checking_the_rep_invariant"></a><span class="panel-title">Checking the rep invariant</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function_3-checking_the_rep_invariant" data-outline="checking_the_rep_invariant" data-ex-id="checking_the_rep_invariant/checking_the_rep_invariant" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<label class="exercise-part-heading" id="@which_following_true"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_following_true"></a>Which of the following are true?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="checkRep() is the abstraction function"><label for="md_converted_choice_22_0"><input type="checkbox" id="md_converted_choice_22_0"><code>checkRep()</code> is the abstraction function</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="checkRep() asserts the rep invariant"><label for="md_converted_choice_22_1"><input type="checkbox" id="md_converted_choice_22_1"><code>checkRep()</code> asserts the rep invariant</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="it’s good for an implementer to call checkRep() just before returning from a public method of an ADT class"><label for="md_converted_choice_22_2"><input type="checkbox" id="md_converted_choice_22_2">it’s good for an implementer to call <code>checkRep()</code> just before returning from a public method of an ADT class</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="it’s good for a client to call checkRep() just after calling a public method of an ADT class"><label for="md_converted_choice_22_3"><input type="checkbox" id="md_converted_choice_22_3">it’s good for a client to call <code>checkRep()</code> just after calling a public method of an ADT class</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

</div><h3 id="no_null_values_in_the_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#no_null_values_in_the_rep"></a>No null values in the rep</h3><div data-outline="no_null_values_in_the_rep">

<p id="@recall_specifications_reading"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@recall_specifications_reading"></a>Recall from the <em>Specifications</em> reading that <a href="https://web.mit.edu/6.102/www/sp25/classes/04-specifications/#avoid_null">null and undefined values are troublesome and unsafe</a>, so much so that we try to remove them from our programming entirely.
Preconditions and postconditions implicitly require that objects be non-null.
Turning on strict null-checking in TypeScript enforces this with static type checking.</p>

<p id="@extend_prohibition_reps"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@extend_prohibition_reps"></a>We extend that prohibition to the reps of abstract data types.
The rep invariant implicitly includes <code>x !== null</code> and <code>x !== undefined</code> for every reference <code>x</code> in the rep, including references inside arrays, maps, etc.
So if your rep is:</p>

<pre id="@class_charset_s"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_charset_s"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> CharSet {
    s: <span class="hljs-built_in">string</span>;
}</code></pre>

<p id="@then_rep_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@then_rep_invariant"></a>then its rep invariant automatically includes <code>s !== null &amp;&amp; s !== undefined</code>, and you don’t need to state that in a rep invariant comment.
And if you have strict null checking enabled (which is the 6.102 TypeScript configuration), the static type checker guarantees it.</p>

<p id="@if_some_field"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@if_some_field"></a>If some field in the rep is allowed to be <code>null</code>, then its type should say so explicitly.
A <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#union-types">union type</a> like <code>string|undefined</code> is an example of how to do that.
But think twice before designing a rep like this, because allowing <code>null</code> and <code>undefined</code> to leak into your code leads to headaches down the road.</p>

<div class="reading-exercises exercises panel-group converted" id="ex-rep_invariant_and_abstraction_function_4"><h4 class="text-danger" id="@reading_exercises_5"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_5"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-rep_invariant_and_abstraction_function_4-null_check" data-target="#ex-rep_invariant_and_abstraction_function_4-null_check" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-rep_invariant_and_abstraction_function_4-null_check"></a><span class="panel-title">Null check?</span></div><div class="panel-collapse collapse exercise-panel" id="ex-rep_invariant_and_abstraction_function_4-null_check" data-outline="null_check" data-ex-id="no_null_values_in_the_rep/null_check" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@consider_rep_some"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@consider_rep_some"></a>Consider this rep for some ADT named Thing:</p>

<pre id="@class_thing_private"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_thing_private"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> Thing {
    <span class="hljs-keyword">private</span> i: <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">private</span> s: <span class="hljs-built_in">string</span>;
    ...
}</code></pre>

<p id="@rep_accompanied_one"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_accompanied_one"></a>The rep is accompanied by one of the rep invariants below.
For each proposed rep invariant, translate it into a <em>minimum</em> set of assertions that you would need to place into <code>checkRep()</code> to check that rep invariant.</p>

<p id="@assume_strict_null-checking"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@assume_strict_null-checking"></a>Assume that strict null-checking is <strong>enabled</strong>.</p>

<pre id="@rep_invariant_i"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_invariant_i"></a><code class="hljs cpp"><span class="hljs-comment">// Rep invariant:</span>
<span class="hljs-comment">//    i is positive</span>

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkRep</span><span class="hljs-params">()</span> </span>{</code></pre>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="assert(i &gt; 0);"><label for="md_converted_choice_23_0"><input type="checkbox" id="md_converted_choice_23_0"><code>assert(i &gt; 0);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="assert(i === s.length);"><label for="md_converted_choice_23_1"><input type="checkbox" id="md_converted_choice_23_1"><code>assert(i === s.length);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="assert(s !== null);"><label for="md_converted_choice_23_2"><input type="checkbox" id="md_converted_choice_23_2"><code>assert(s !== null);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="assert(i !== null);"><label for="md_converted_choice_23_3"><input type="checkbox" id="md_converted_choice_23_3"><code>assert(i !== null);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="none of the above (checkRep() can be empty or omitted entirely)"><label for="md_converted_choice_23_4"><input type="checkbox" id="md_converted_choice_23_4">none of the above (<code>checkRep()</code> can be empty or omitted entirely)</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<pre><code class="hljs">}</code></pre>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<pre id="@rep_invariant_length"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rep_invariant_length"></a><code class="hljs cpp"><span class="hljs-comment">// Rep invariant:</span>
<span class="hljs-comment">//    the length of s is even</span>

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkRep</span><span class="hljs-params">()</span> </span>{</code></pre>

<div class="form-group exercise-part" data-outline="b"><div class="checkbox exercise-choice" data-outline="assert(s.length % 2 === 0);"><label for="md_converted_choice_24_0"><input type="checkbox" id="md_converted_choice_24_0"><code>assert(s.length % 2 === 0);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="assert(s !== &quot;&quot;);"><label for="md_converted_choice_24_1"><input type="checkbox" id="md_converted_choice_24_1"><code>assert(s !== "");</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="assert(s !== null);"><label for="md_converted_choice_24_2"><input type="checkbox" id="md_converted_choice_24_2"><code>assert(s !== null);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="assert(i !== null);"><label for="md_converted_choice_24_3"><input type="checkbox" id="md_converted_choice_24_3"><code>assert(i !== null);</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="none of the above (checkRep() can be empty or omitted entirely)"><label for="md_converted_choice_24_4"><input type="checkbox" id="md_converted_choice_24_4">none of the above (<code>checkRep()</code> can be empty or omitted entirely)</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<pre><code class="hljs">}</code></pre>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

</div></div><h2 id="benevolent_side-effects"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#benevolent_side-effects"></a>Benevolent side-effects</h2><div data-outline="benevolent_side-effects">

<p id="@recall_type_immutable"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@recall_type_immutable"></a>Recall that a type is immutable if and only if a value of the type never changes after being created.
With our new understanding of the abstract space A and rep space R, we can refine this definition: the <em>abstract value</em> should never change.
But the implementation is free to mutate a <em>rep value</em> as long as it continues to map to the same abstract value, so that the change is invisible to the client.
This kind of change is called a <mark data-structure-text="benevolent side-effect" id="^benevolent_side-effect"><strong>benevolent side-effect</strong></mark>.</p>

<p id="@here-s_simple_example"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@here-s_simple_example"></a>Here’s a simple example using an alternative rep for the <code>RatNum</code> type we saw earlier.
This rep has a weaker rep invariant that doesn’t require the numerator and denominator to be stored in lowest terms:</p>

<pre id="@class_ratnum_private_numerator_bigint_private"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@class_ratnum_private_numerator_bigint_private"></a><code class="language-ts hljs typescript"><span class="hljs-keyword">class</span> RatNum {

    <span class="hljs-keyword">private</span> numerator: bigint;
    <span class="hljs-keyword">private</span> denominator: bigint;

    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   denominator != 0</span>

    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(numerator, denominator) = numerator/denominator</span>

    <span class="hljs-comment">/**
     * Make a new RatNum = (n / d).
     * @param n numerator
     * @param d denominator
     * @throws Error if d = 0
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">n: bigint, d: bigint</span>) {
        <span class="hljs-keyword">if</span> (d === <span class="hljs-number">0n</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"denominator is zero"</span>);
        <span class="hljs-keyword">this</span>.numerator = n;
        <span class="hljs-keyword">this</span>.denominator = d;
        checkRep();
    }

    ...
}</code></pre>

<p id="@weaker_rep_invariant"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@weaker_rep_invariant"></a>This weaker rep invariant allows a sequence of <code>RatNum</code> arithmetic operations to simply omit reducing the result to lowest terms.
But when it’s time to display a result to a human, we first simplify it:</p>

<pre id="@returns_string_representation"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@returns_string_representation"></a><code class="language-ts hljs typescript">    <span class="hljs-comment">/**
     * @returns a string representation of this rational number
     */</span>
    <span class="hljs-keyword">public</span> toString(): <span class="hljs-built_in">string</span> {
        <span class="hljs-keyword">const</span> g = gcd(<span class="hljs-keyword">this</span>.numerator, <span class="hljs-keyword">this</span>.denominator);
        <span class="hljs-keyword">this</span>.numerator /= g;
        <span class="hljs-keyword">this</span>.denominator /= g;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.denominator &lt; <span class="hljs-number">0n</span>) {
            <span class="hljs-keyword">this</span>.numerator = -<span class="hljs-keyword">this</span>.numerator;
            <span class="hljs-keyword">this</span>.denominator = -<span class="hljs-keyword">this</span>.denominator;
        }
        checkRep();
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.denominator &gt; <span class="hljs-number">1n</span>) ? (<span class="hljs-keyword">this</span>.numerator + <span class="hljs-string">"/"</span> + <span class="hljs-keyword">this</span>.denominator)
                                 : (<span class="hljs-keyword">this</span>.numerator + <span class="hljs-string">""</span>);
    }</code></pre>

<p id="@notice_tostring_implementation"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@notice_tostring_implementation"></a>Notice that this <code>toString</code> implementation reassigns the private fields <code>numerator</code> and <code>denominator</code>, mutating the representation – even though it is an observer method on an immutable type!
But, crucially, the mutation doesn’t change the abstract value.
Dividing both numerator and denominator by the same common factor, or multiplying both by -1, has no effect on the result of the abstraction function, <code>AF(numerator, denominator) = numerator/denominator</code>.
Another way of thinking about it is that the AF is a many-to-one function, and the rep value has changed to another that still maps to the same abstract value.
So the mutation is harmless, or <em>benevolent</em>.</p>

<p id="@see_other_examples"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@see_other_examples"></a>We’ll see other examples of benevolent side-effects in future readings.
This kind of implementer freedom often permits performance improvements like caching, data structure rebalancing, and lazy cleanup.</p>

</div><h2 id="documenting_the_af_ri_and_safety_from_rep_exposure"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#documenting_the_af_ri_and_safety_from_rep_exposure"></a>Documenting the AF, RI, and safety from rep exposure</h2><div data-outline="documenting_the_af_ri_and_safety_from_rep_exposure">

<p id="@good_practice_document"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@good_practice_document"></a>It’s good practice to document the abstraction function and rep invariant in the class, using comments right where the private fields of the rep are declared.
We’ve been doing that above.</p>

<p id="@you_describe_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@you_describe_rep"></a>When you describe the rep invariant and abstraction function, you must be <em>precise</em>.</p>

<p id="@not_enough_ri"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@not_enough_ri"></a>It is not enough for the RI to be a generic statement like “all fields are valid.”
The job of the rep invariant is to explain precisely what makes the field values valid or not.</p>

<p id="@function_if_take_documented_ri_substitute"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@function_if_take_documented_ri_substitute"></a>As a <em>function</em>, if we take the documented RI and substitute in actual field values, legal or not, we should obtain a boolean result.
Note that if we’re tempted to refer to the abstract value in our RI, we’ve put the cart before the horse: illegal rep values <em>don’t have an abstract value</em>, and we need to reject them in the RI by talking about the rep values alone.</p>

<p id="@not_enough_af"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@not_enough_af"></a>It is not enough for the AF to offer a generic explanation like “represents a set of characters.”
The job of the abstraction function is to define precisely how the concrete field values are interpreted.</p>

<p id="@function_if_take_documented_af_substitute"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@function_if_take_documented_af_substitute"></a>As a <em>function</em>, if we take the documented AF and substitute in actual legal field values, we should obtain out a complete description of the single abstract value they represent.
For example, for the <code>CharSet</code> abstraction function <code>AF(s) = {s[i] | 0 &lt;= i &lt; s.length}</code>, we can substitute a specific (legal) rep value like <code>s="abbc"</code>, and get: <br>
<code>AF("abbc")</code> = <code>{ "abbc"[i] | 0 &lt;= i &lt; "abbc".length }</code> = <code>{ 'a', 'b', 'c' }</code>.</p>

<p id="@but_if_instead"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@but_if_instead"></a>But if we instead had a vague and ill-defined abstraction function like <code>AF(s) = a set of characters</code>, then substituting for <code>s</code> would not affect the righthand side at all.
This definition does not say precisely which abstract set of characters corresponds to the rep value <code>s="abbc"</code>.</p>

<p id="@precise_statement_can"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@precise_statement_can"></a>A precise statement can be made either symbolically (like <code>{s[i] | 0 &lt;= i &lt; s.length}</code>) or in English (like “the set of all characters found in <code>s</code>“).  You have written both kinds of statements in your math classes, and you should take the same mathematical perspective here.  Symbolic expressions may <em>seem</em> more precise, and English may <em>seem</em> fuzzier, but that’s just a matter of perception: both approaches can be done either carefully or sloppily. As a rule of thumb, use symbolic expressions when they can be concise and simple, and use English to convey something complicated, but in both cases, aim to be <em>precise</em>.</p>

<p id="@another_piece_documentation"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@another_piece_documentation"></a>Another piece of documentation that 6.102 asks you to write is a <mark data-mark-text="safety-from-rep-exposure argument (SRE)" data-structure-text="safety-from-rep-exposure argument (SRE)" id="^safety-from-rep-exposure_argument_sre"><strong>rep exposure safety argument</strong></mark>.  This is a comment that examines each part of the rep, looks at the code that handles that part of the rep (particularly with respect to parameters and return values from clients, because that is where rep exposure occurs), and presents a reason why the code doesn’t expose the rep.</p>

<p id="@here-s_example_tweet"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@here-s_example_tweet"></a>Here’s an example of <code>Tweet</code> with its rep invariant, abstraction function, and safety from rep exposure fully documented:</p>

<pre id="@immutable_type_representing_tweet_class_tweet"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@immutable_type_representing_tweet_class_tweet"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// Immutable type representing a tweet.</span>
<span class="hljs-keyword">class</span> Tweet {

    <span class="hljs-keyword">private</span> readonly author: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">private</span> readonly text: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">private</span> readonly timestamp: <span class="hljs-built_in">Date</span>;

    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   author is a Twitter username (a nonempty string of letters, digits, underscores)</span>
    <span class="hljs-comment">//   text.length &lt;= 280</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(author, text, timestamp) = a tweet posted by author, with content text,</span>
    <span class="hljs-comment">//                                 at time timestamp</span>
    <span class="hljs-comment">// Safety from rep exposure:</span>
    <span class="hljs-comment">//   All fields are private;</span>
    <span class="hljs-comment">//   author and text are Strings, so are guaranteed immutable;</span>
    <span class="hljs-comment">//   timestamp is a mutable Date, so Tweet() constructor and getTimestamp()</span>
    <span class="hljs-comment">//        make defensive copies to avoid sharing the rep's Date object with clients.</span>

    <span class="hljs-comment">// Operations (specs and method bodies omitted to save space)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">author: <span class="hljs-built_in">string</span>, text: <span class="hljs-built_in">string</span>, timestamp: <span class="hljs-built_in">Date</span></span>) { ... }
    <span class="hljs-keyword">public</span> getAuthor(): <span class="hljs-built_in">string</span> { ... }
    <span class="hljs-keyword">public</span> getText(): <span class="hljs-built_in">string</span> { ... }
    <span class="hljs-keyword">public</span> getTimestamp(): <span class="hljs-built_in">Date</span> { ... }
}</code></pre>

<p id="@notice_don-t_any"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@notice_don-t_any"></a>Notice that we don’t have any explicit rep invariant conditions on <code>timestamp</code> (aside from the conventional assumption that <code>timestamp</code> is not <code>null</code>, which we have for all object references).  But we still need to include <code>timestamp</code> in the rep exposure safety argument, because the immutability property of the whole type depends on the abstract value remaining unchanged, and the abstraction function uses <code>timestamp</code> to map to the abstract value.
Not only does the argument include what TypeScript can statically check (private fields and types), but it also references what the implementer actively does to enforce the rep invariant.</p>

<p id="@compare_argument_above"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@compare_argument_above"></a>Compare the argument above with <a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/code.html#bad_Timespan_argument">an example of a broken argument involving mutable <code>Date</code> objects</a>.</p>

<p id="@here_arguments_ratnum"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@here_arguments_ratnum"></a>Here are the arguments for <code>RatNum</code>.</p>

<pre id="@immutable_type_representing_rational_number_class"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@immutable_type_representing_rational_number_class"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// Immutable type representing a rational number.</span>
<span class="hljs-keyword">class</span> RatNum {
    <span class="hljs-keyword">private</span> readonly numerator: bigint;
    <span class="hljs-keyword">private</span> readonly denominator: bigint;

    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   denominator &gt; 0</span>
    <span class="hljs-comment">//   numerator/denominator is in reduced form, i.e. gcd(|numerator|,denominator) = 1</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(numerator, denominator) = numerator/denominator</span>
    <span class="hljs-comment">// Safety from rep exposure:</span>
    <span class="hljs-comment">//   All fields are private, and all types in the rep are immutable.</span>

    <span class="hljs-comment">// Operations (specs and method bodies omitted to save space)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">n: bigint, d: bigint</span>) { ... }
    ...
}</code></pre>

<p id="@notice_immutable_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@notice_immutable_rep"></a>Notice that an immutable rep is particularly easy to argue for safety from rep exposure.</p>

<div class="handout-solo alert alert-warning"><p id="@you_can_look_full_code_ratnum"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@you_can_look_full_code_ratnum"></a>You can look at <a href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/code.html#ratnumts" class="alert-link">the full code for <code>RatNum</code></a>.</p></div>

<div class="reading-exercises exercises panel-group converted" id="ex-documenting_the_af_ri_and_safety_from_rep_exposure"><h4 class="text-danger" id="@reading_exercises_6"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_6"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-documenting_the_af_ri_and_safety_from_rep_exposure-arguing_against_rep_exposure" data-target="#ex-documenting_the_af_ri_and_safety_from_rep_exposure-arguing_against_rep_exposure" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-documenting_the_af_ri_and_safety_from_rep_exposure-arguing_against_rep_exposure"></a><span class="panel-title">Arguing against rep exposure</span></div><div class="panel-collapse collapse exercise-panel" id="ex-documenting_the_af_ri_and_safety_from_rep_exposure-arguing_against_rep_exposure" data-outline="arguing_against_rep_exposure" data-ex-id="documenting_the_af_ri_and_safety_from_rep_exposure/arguing_against_rep_exposure" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@consider_following_adt"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@consider_following_adt"></a>Consider the following ADT:</p>

<pre id="followgraph"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#followgraph"></a><code class="language-ts hljs typescript"><span class="hljs-comment">// Mutable type representing Twitter users' followers.</span>
<span class="hljs-keyword">class</span> FollowGraph {
    <span class="hljs-keyword">private</span> readonly followersOf: Map&lt;<span class="hljs-built_in">string</span>,Set&lt;<span class="hljs-built_in">string</span>&gt;&gt;;

    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//    all strings in followersOf are Twitter usernames</span>
    <span class="hljs-comment">//           (i.e., nonempty strings of letters, digits, underscores)</span>
    <span class="hljs-comment">//    no user follows themselves, i.e. x is not in followersOf.get(x)</span>
    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//    AF(followersOf) = the follower graph where Twitter user x is followed by user y</span>
    <span class="hljs-comment">//                      if and only if followersOf.get(x).has(y)</span>
    <span class="hljs-comment">// Safety from rep exposure:</span>
    <span class="hljs-comment">//    All fields are private, and ..???..</span>

    <span class="hljs-comment">// Operations (specs and method bodies omitted to save space)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) { ... }
    <span class="hljs-keyword">public</span> addFollower(user: <span class="hljs-built_in">string</span>, follower: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> { ... }
    <span class="hljs-keyword">public</span> removeFollower(user: <span class="hljs-built_in">string</span>, follower: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> { ... }
    <span class="hljs-keyword">public</span> getFollowers(user: <span class="hljs-built_in">string</span>): Set&lt;<span class="hljs-built_in">string</span>&gt; { ... }
}</code></pre>

<p id="@each_statement_below"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@each_statement_below"></a>For each statement below: assuming the omitted method bodies are consistent with the statement, can we use the statement in place of <code>..???..</code> to make a complete and persuasive safety-from-rep-exposure comment?</p>

<p id="@1_strings_immutable"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@1_strings_immutable"></a><strong>1.</strong> “Strings are immutable.”</p>

<div class="form-group exercise-part" data-outline="a"><div class="radio exercise-choice" data-outline="Yes"><label for="md_converted_choice_25_0"><input type="radio" id="md_converted_choice_25_0" name="md_converted_radio_25">Yes</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="No"><label for="md_converted_choice_25_1"><input type="radio" id="md_converted_choice_25_1" name="md_converted_radio_25">No</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@2_followersof_mutable"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@2_followersof_mutable"></a><strong>2.</strong> “<code>followersOf</code> is a mutable <code>Map</code> containing mutable <code>Set</code> objects, but <code>getFollowers()</code> makes a defensive copy of the <code>Set</code> it returns, and all other parameters and return values and element types of <code>Set</code> or <code>Map</code> are immutable <code>string</code> or <code>void</code>.”</p>

<div class="form-group exercise-part" data-outline="b"><div class="radio exercise-choice" data-outline="Yes"><label for="md_converted_choice_26_0"><input type="radio" id="md_converted_choice_26_0" name="md_converted_radio_26">Yes</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="No"><label for="md_converted_choice_26_1"><input type="radio" id="md_converted_choice_26_1" name="md_converted_radio_26">No</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@3_class_mutable"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@3_class_mutable"></a><strong>3.</strong> “This class is mutable, so rep exposure isn’t an issue.”</p>

<div class="form-group exercise-part" data-outline="c"><div class="radio exercise-choice" data-outline="Yes"><label for="md_converted_choice_27_0"><input type="radio" id="md_converted_choice_27_0" name="md_converted_radio_27">Yes</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="No"><label for="md_converted_choice_27_1"><input type="radio" id="md_converted_choice_27_1" name="md_converted_radio_27">No</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@4_followersof_mutable"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@4_followersof_mutable"></a><strong>4.</strong> “<code>followersOf</code> is a mutable Map, but it is never passed or returned from an operation.”</p>

<div class="form-group exercise-part" data-outline="d"><div class="radio exercise-choice" data-outline="Yes"><label for="md_converted_choice_28_0"><input type="radio" id="md_converted_choice_28_0" name="md_converted_radio_28">Yes</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="No"><label for="md_converted_choice_28_1"><input type="radio" id="md_converted_choice_28_1" name="md_converted_radio_28">No</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@5_followgraph_does"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@5_followgraph_does"></a><strong>5.</strong> “<code>FollowGraph()</code> does not expose the rep; <code>addFollower()</code> does not expose the rep; <code>removeFollower()</code> does not expose the rep; <code>getFollowers()</code> does not expose the rep.”</p>

<div class="form-group exercise-part" data-outline="e"><div class="radio exercise-choice" data-outline="Yes"><label for="md_converted_choice_29_0"><input type="radio" id="md_converted_choice_29_0" name="md_converted_radio_29">Yes</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="No"><label for="md_converted_choice_29_1"><input type="radio" id="md_converted_choice_29_1" name="md_converted_radio_29">No</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<p id="@6_string_immutable"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@6_string_immutable"></a><strong>6.</strong> “<code>string</code> is immutable.  The <code>Set</code> type in the rep is mutable, and the same type is returned by <code>getFollowers()</code>, but that return value is a fresh defensive copy, not a reference to any set stored in the rep.  The <code>Map</code> type in the rep is mutable, but that type is never passed or returned from an operation.”</p>

<div class="form-group exercise-part" data-outline="f"><div class="radio exercise-choice" data-outline="Yes"><label for="md_converted_choice_30_0"><input type="radio" id="md_converted_choice_30_0" name="md_converted_radio_30">Yes</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="radio exercise-choice" data-outline="No"><label for="md_converted_choice_30_1"><input type="radio" id="md_converted_choice_30_1" name="md_converted_radio_30">No</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

<h3 id="what_an_adt_specification_may_talk_about"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#what_an_adt_specification_may_talk_about"></a>What an ADT specification may talk about</h3><div data-outline="what_an_adt_specification_may_talk_about">

<div class="panel panel-default panel-figure pull-right no-markdown">
<div class="panel-body text-center">
<img src="./RepInvariants_files/adt-firewall.svg" class="pull-right" width="300">
</div></div>

<p id="@since_we-ve_just"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@since_we-ve_just"></a>Since we’ve just discussed where to document the rep invariant and abstraction function, now is a good moment to update our notion of <a href="https://web.mit.edu/6.102/www/sp25/classes/04-specifications/#what_a_specification_may_talk_about">what a specification may talk about</a>.</p>

<p id="@specification_abstract_type"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@specification_abstract_type"></a>The specification of an abstract type <em>T</em> – which consists of the specs of its operations – should only talk about things that are visible to the client.
This includes parameters, return values, and exceptions thrown by its operations.
Whenever the spec needs to refer to a value of type <em>T</em>, it should describe the value as an <em>abstract value</em>, i.e. mathematical values in the abstract space A.</p>

<p id="@spec_should_not"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@spec_should_not"></a>The spec should not talk about details of the representation, or elements of the rep space R.
It should consider the rep itself (the private fields) invisible to the client, just as method bodies and their local variables are considered invisible.
That’s why we write the rep invariant and abstraction function as ordinary comments within the body of the class, rather than TypeDoc comments above the class.
Writing them as TypeDoc comments would commit to them as public parts of the type’s specification, which would interfere with rep independence and information hiding.</p>

</div></div><h2 id="adt_invariants_replace_preconditions"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#adt_invariants_replace_preconditions"></a>ADT invariants replace preconditions</h2><div data-outline="adt_invariants_replace_preconditions">

<p id="@now_bring_lot"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@now_bring_lot"></a>Now let’s bring a lot of pieces together.  An enormous advantage of a well-designed abstract data type is that it encapsulates and enforces properties that we would otherwise have to stipulate in a precondition.  For example, instead of a spec like this, with an elaborate precondition:</p>

<pre id="@param_set1_sorted"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@param_set1_sorted"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * @param set1 is a sorted set of characters with no repeats
 * @param set2 is likewise
 * @returns characters that appear in one set but not the other,
 *  in sorted order with no repeats
 */</span>
<span class="hljs-keyword">static</span> exclusiveOr(set1: <span class="hljs-built_in">string</span>, set2: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span>;</code></pre>

<p id="@might_instead_use"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@might_instead_use"></a>We might instead use an ADT that captures the desired property:</p>

<pre id="@returns_characters_appear"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@returns_characters_appear"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * @returns characters that appear in one set but not the other
 */</span>
<span class="hljs-keyword">static</span> exclusiveOr(set1: SortedCharSet, set2: SortedCharSet): SortedCharSet;</code></pre>

<p id="@hits_all_our"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@hits_all_our"></a>This hits all our targets:</p>

<ul>
<li><p id="@safer_bugs_because"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@safer_bugs_because"></a>it’s safer from bugs, because the required condition (sorted with no repeats) can be enforced in exactly one place, the <code>SortedCharSet</code> type, and because static checking comes into play, preventing values that don’t satisfy this condition from being used at all, with an error at compile-time.</p></li>
<li><p id="@easier_understand_because"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@easier_understand_because"></a>it’s easier to understand, because it’s much simpler, and the name <code>SortedCharSet</code> conveys what the programmer needs to know.</p></li>
<li><p id="@more_ready_change"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@more_ready_change"></a>it’s more ready for change, because the representation of <code>SortedCharSet</code> can now be changed without changing <code>exclusiveOr</code> or any of its clients.</p></li>
</ul>

<p id="@many_places_used"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@many_places_used"></a>Many of the places where we used preconditions earlier in this course would have benefited from a custom ADT instead.</p>

<div class="reading-exercises exercises panel-group converted" id="ex-adt_invariants_replace_preconditions"><h4 class="text-danger" id="@reading_exercises_7"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_7"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-adt_invariants_replace_preconditions-encapsulating_preconditions_in_adts" data-target="#ex-adt_invariants_replace_preconditions-encapsulating_preconditions_in_adts" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-adt_invariants_replace_preconditions-encapsulating_preconditions_in_adts"></a><span class="panel-title">Encapsulating preconditions in ADTs</span></div><div class="panel-collapse collapse exercise-panel" id="ex-adt_invariants_replace_preconditions-encapsulating_preconditions_in_adts" data-outline="encapsulating_preconditions_in_adts" data-ex-id="adt_invariants_replace_preconditions/encapsulating_preconditions_in_adts" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@consider_function"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@consider_function"></a>Consider this function:</p>

<pre id="@find_tweets_written"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@find_tweets_written"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/**
 * Find tweets written by a particular user.
 *
 * @param tweets an array of tweets with distinct timestamps, not modified by this function.
 * @param username Twitter username (a nonempty sequence of letters, digits, and underscores)
 * @returns all and only the tweets in the array whose author is username,
 *         in the same order as in the input array.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writtenBy</span>(<span class="hljs-params">tweets: <span class="hljs-built_in">Array</span>&lt;Tweet&gt;, username: <span class="hljs-built_in">string</span></span>): <span class="hljs-title">Array</span>&lt;<span class="hljs-title">Tweet</span>&gt; </span>{ ... }</code></pre>

<label class="exercise-part-heading" id="@which_adts_would"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@which_adts_would"></a>Which ADTs would you use in this spec to eliminate the preconditions of this function?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="TweetsAndUsername"><label for="md_converted_choice_31_0"><input type="checkbox" id="md_converted_choice_31_0"><code>TweetsAndUsername</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="TweetArray"><label for="md_converted_choice_31_1"><input type="checkbox" id="md_converted_choice_31_1"><code>TweetArray</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="Username"><label for="md_converted_choice_31_2"><input type="checkbox" id="md_converted_choice_31_2"><code>Username</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
<div class="checkbox exercise-choice" data-outline="Array&lt;UsernameCharacter&gt;"><label for="md_converted_choice_31_3"><input type="checkbox" id="md_converted_choice_31_3"><code>Array&lt;UsernameCharacter&gt;</code></label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

<h3 id="how_to_establish_invariants"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#how_to_establish_invariants"></a>How to establish invariants</h3><div data-outline="how_to_establish_invariants">

<p id="@invariant_property_true"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@invariant_property_true"></a>An invariant is a property that is true for the entire program – which in the case of an invariant about an object, reduces to the entire lifetime of the object.</p>

<p id="@make_invariant_hold"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@make_invariant_hold"></a>To make an invariant hold, we need to:</p>

<ul id="@make_invariant_true">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@make_invariant_true"></a>make the invariant true in the initial state of the object; and</li>
<li>ensure that all changes to the object keep the invariant true.</li>
</ul>

<p id="@translating_terms_types"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@translating_terms_types"></a>Translating this in terms of the types of ADT operations, this means:</p>

<ul id="@creators_producers_must">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@creators_producers_must"></a>creators and producers must establish the invariant for new object instances; and</li>
<li>mutators, observers, and producers must preserve the invariant for existing object instances.</li>
</ul>

<p id="@risk_rep_exposure"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@risk_rep_exposure"></a>The risk of rep exposure makes the situation more complicated.
If the rep is exposed, then the object might be changed anywhere in the program, not just in the ADT’s operations, and we can’t guarantee that the invariant still holds after those arbitrary changes.</p>

<p id="@so_full_rule"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@so_full_rule"></a>So the full rule for proving invariants is as follows:</p>

<blockquote>
  <p id="@if_invariant_abstract"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@if_invariant_abstract"></a>If an invariant of an abstract data type is</p>
  
  <ol id="@established_creators_producers">
  <li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@established_creators_producers"></a>established by creators and producers;</li>
  <li>preserved by mutators, observers, and producers; and</li>
  <li>no representation exposure occurs,</li>
  </ol>
  
  <p id="@then_invariant_true"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@then_invariant_true"></a>then the invariant is true of all instances of the abstract data type.</p>
</blockquote>

<p id="@rule_applies_structural"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@rule_applies_structural"></a>This rule applies <mark data-structure-text="structural induction" id="^structural_induction"><em><a href="https://en.wikipedia.org/wiki/Structural_induction">structural induction</a></em></mark> over the abstract data type.</p>

<div class="reading-exercises exercises panel-group converted" id="ex-adt_invariants_replace_preconditions_2"><h4 class="text-danger" id="@reading_exercises_8"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@reading_exercises_8"></a>reading exercises</h4><div class="panel panel-danger"><div class="panel-heading" data-structure-tag="exercise" id="@ex-adt_invariants_replace_preconditions_2-structural_induction" data-target="#ex-adt_invariants_replace_preconditions_2-structural_induction" data-toggle="collapse"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ex-adt_invariants_replace_preconditions_2-structural_induction"></a><span class="panel-title">Structural induction</span></div><div class="panel-collapse collapse exercise-panel" id="ex-adt_invariants_replace_preconditions_2-structural_induction" data-outline="structural_induction" data-ex-id="how_to_establish_invariants/structural_induction" data-ex-category="reading-exercises" data-ex-remote="https://handx.mit.edu/v1/6.102/sp25/submit" data-ex-handout="classes-07-abstraction-functions-rep-invariants"><div class="panel-body">

<p id="@recall_data_type"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@recall_data_type"></a>Recall this data type from the first exercise in this reading, now with a different rep (and new bugs):</p>

<pre id="@represents_immutable_right_triangle_class_righttriangle_private_sides_number"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@represents_immutable_right_triangle_class_righttriangle_private_sides_number"></a><code class="language-ts hljs typescript"><span class="hljs-comment">/** Represents an immutable right triangle. */</span>
<span class="hljs-keyword">class</span> RightTriangle {
    <span class="hljs-keyword">private</span> sides: <span class="hljs-built_in">number</span>[];

    <span class="hljs-comment">// Rep invariant:</span>
    <span class="hljs-comment">//   sides.length = 3</span>
    <span class="hljs-comment">//   sides[i] &gt; 0 for all i</span>
    <span class="hljs-comment">//   sides[0]^2 + sides[1]^2 = sides[2]^2 (within the error tolerance of double arithmetic)</span>

    <span class="hljs-comment">// Abstraction function:</span>
    <span class="hljs-comment">//   AF(sides) = the right triangle with legs sides[0] and sides[1], and hypotenuse sides[2]</span>


    <span class="hljs-comment">/**
     * Make a right triangle.
     * @param legA, legB  the two legs of the triangle, must be positive
     * @param hypotenuse  the hypotenuse of the triangle, also positive,
     *           requires hypotenuse^2 = legA^2 + legB^2
     *           (within the error tolerance of double arithmetic)
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-params">legA: <span class="hljs-built_in">number</span>, legB: <span class="hljs-built_in">number</span>, hypotenuse: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">this</span>.sides = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(legA, legB, hypotenuse);
    }

    <span class="hljs-comment">/**
     * Get all the sides of the triangle.
     * @returns three-element array with the triangle's side lengths
     */</span>
    <span class="hljs-keyword">public</span> getAllSides(): <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sides;
    }

    <span class="hljs-comment">/**
     * @returns length of the triangle's hypotenuse
     */</span>
    <span class="hljs-keyword">public</span> getHypotenuse(): <span class="hljs-built_in">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">2</span>];
    }

    <span class="hljs-comment">/**
     * @param factor to multiply the sides by, must be &gt;0
     * @returns a triangle made from this triangle by
     * multiplying all side lengths by factor.
     */</span>
    <span class="hljs-keyword">public</span> scale(factor: <span class="hljs-built_in">number</span>): RightTriangle {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RightTriangle(<span class="hljs-keyword">this</span>.sides[<span class="hljs-number">0</span>]*factor, <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">1</span>]*factor, <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">2</span>]*factor);
    }

    <span class="hljs-comment">/**
     * @returns a regular triangle made from this triangle.
     * A regular right triangle is one in which
     * both legs have the same length.
     */</span>
    <span class="hljs-keyword">public</span> regularize(): RightTriangle {
        <span class="hljs-keyword">const</span> bigLeg: <span class="hljs-built_in">number</span> = <span class="hljs-built_in">Math</span>.max(<span class="hljs-keyword">this</span>.sides[<span class="hljs-number">0</span>], <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">1</span>]);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RightTriangle(bigLeg, bigLeg, <span class="hljs-keyword">this</span>.sides[<span class="hljs-number">2</span>]);
    }

}</code></pre>

<p id="@data_type_important"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@data_type_important"></a>This data type has an important invariant: the relationship between the legs and hypotenuse, as stated in the Pythagorean theorem.</p>

<label class="exercise-part-heading" id="@assuming_client_obeys"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@assuming_client_obeys"></a>Assuming the client obeys the contracts when using RightTriangle, which of the following statements are true about this invariant?</label>

<div class="form-group exercise-part" data-outline="a"><div class="checkbox exercise-choice" data-outline="The creator RightTriangle() establishes the invariant if the client obeys all contracts."><label for="md_converted_choice_32_0"><input type="checkbox" id="md_converted_choice_32_0">The creator <code>RightTriangle()</code> establishes the invariant if the client obeys all contracts.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="b"><div class="checkbox exercise-choice" data-outline="The observer getAllSides() preserves the invariant if the client obeys all contracts."><label for="md_converted_choice_33_0"><input type="checkbox" id="md_converted_choice_33_0">The observer <code>getAllSides()</code> preserves the invariant if the client obeys all contracts.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="c"><div class="checkbox exercise-choice" data-outline="The observer getHypotenuse() preserves the invariant if the client obeys all contracts."><label for="md_converted_choice_34_0"><input type="checkbox" id="md_converted_choice_34_0">The observer <code>getHypotenuse()</code> preserves the invariant if the client obeys all contracts.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="d"><div class="checkbox exercise-choice" data-outline="The producer scale() preserves the invariant if the client obeys all contracts."><label for="md_converted_choice_35_0"><input type="checkbox" id="md_converted_choice_35_0">The producer <code>scale()</code> preserves the invariant if the client obeys all contracts.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div>

<div class="form-group exercise-part" data-outline="e"><div class="checkbox exercise-choice" data-outline="The producer regularize() preserves the invariant if the client obeys all contracts."><label for="md_converted_choice_36_0"><input type="checkbox" id="md_converted_choice_36_0">The producer <code>regularize()</code> preserves the invariant if the client obeys all contracts.</label><span class="exercise-answer exercise-remote" style="display: none;">(missing answer)</span></div>
</div>

<div class="exercise-explain exercise-remote"><p>(missing explanation)</p></div><div class="form-inline"><div class="form-group"><button class="btn btn-default exercise-submit">check</button> <button class="btn btn-default exercise-reveal" style="display: none;">explain</button></div><div class="exercise-progress progress"><div class="progress-bar progress-bar-danger progress-bar-striped active"></div></div><div class="exercise-error"></div></div></div></div></div></div>

</div></div><h2 id="recipes_for_programming"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#recipes_for_programming"></a>Recipes for programming</h2><div data-outline="recipes_for_programming">

<p id="@abstract_data_types"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@abstract_data_types"></a>Abstract data types are at the heart of software construction for correctness, clarity, and changeability.</p>

<p id="@recall_test-first_programming"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@recall_test-first_programming"></a>Recall the <a href="https://web.mit.edu/6.102/www/sp25/classes/02-testing/#iterative_test-first_programming">test-first programming approach</a> for:</p>

<h3 id="writing_a_method"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#writing_a_method"></a>Writing a method</h3><div data-outline="writing_a_method">

<div class="list-style-sub-lower-alpha"><ol id="@spec_write_spec">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@spec_write_spec"></a><strong>Spec.</strong>
Write the spec, including the method signature (name, argument types, return types, exceptions), and the precondition and the postcondition as a documentation comment.</li>
<li><strong>Test.</strong>
Create systematic test cases and put them in test file so you can run them automatically.

<ol><li>You may have to go back and change your spec when you start to write test cases.
Just the process of writing test cases puts pressure on your spec, because you’re thinking about how a client would call the method.
So steps 1 and 2 iterate until you’ve got a better spec and some good test cases.</li>
<li>Make sure at least some of your tests are <em>failing</em> at first.
A test suite that passes all tests even when you haven’t implemented the method is not a good test suite for finding bugs.</li></ol></li>
<li><strong>Implement.</strong>
Write the body of the method.
You’re done when the tests are all passing.

<ol><li>Implementing the method puts pressure on both the tests and the specs, and you may find bugs that you have to go back and fix.
So finishing the method may require changing the implementation, the tests, and the specs, and bouncing back and forth among them.</li></ol></li>
</ol></div>

<p id="@broaden_recipe"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@broaden_recipe"></a>Let’s broaden this to a recipe for:</p>

</div><h3 id="writing_an_abstract_data_type"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#writing_an_abstract_data_type"></a>Writing an abstract data type</h3><div data-outline="writing_an_abstract_data_type">

<div class="list-style-sub-lower-alpha"><ol id="@spec_write_specs">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@spec_write_specs"></a><strong>Spec.</strong>
Write specs for the operations of the data type, including method signatures, preconditions, and postconditions.

<ol><li>This includes defining the abstract value space, but not the abstraction function (since we don’t have a rep yet).</li></ol></li>
<li><strong>Test.</strong>
Write test cases for the ADT’s operations.

<ol><li>Again, this puts pressure on the spec.
You may discover that you need operations you hadn’t anticipated, so you’ll have to add them to the spec.</li></ol></li>
<li><strong>Implement.</strong>
For an ADT, this part expands to:

<ol><li><strong>Choose rep.</strong>
Write down the private fields of a class (or, as we’ll see in future readings, choose and define a different kind of rep).
Write down the rep invariant and abstraction function as a comment.</li>
<li><strong>Assert rep invariant.</strong>
Implement a <code>checkRep()</code> method that enforces the rep invariant.
This is critically important if the rep invariant is nontrivial, because it will catch bugs much earlier.</li>
<li><strong>Implement operations.</strong>
Write the method bodies of the operations, making sure to call <code>checkRep()</code> in them.
You’re done when the tests are all passing.</li></ol></li>
</ol></div>

<p id="@broaden_further_recipe"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@broaden_further_recipe"></a>And let’s broaden it further to a recipe for:</p>

</div><h3 id="writing_a_program"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#writing_a_program"></a>Writing a program</h3><div data-outline="writing_a_program">

<p id="@consisting_adts_functions"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@consisting_adts_functions"></a>(consisting of ADTs and functions)</p>

<div class="list-style-sub-lower-alpha"><ol id="@choose_data_types">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@choose_data_types"></a><strong>Choose data types.</strong>
Decide which ones will be mutable and which immutable.</li>
<li><strong>Choose functions.</strong>
Write your top-level <code>main</code> function and break it down into smaller steps.</li>
<li><strong>Spec.</strong>
Spec out the ADTs and functions.
Keep the ADT operations simple and few at first.
Only add complex operations as you need them.</li>
<li><strong>Test.</strong>
Write test cases for each unit (ADT or function).</li>
<li><strong>Implement simply first.</strong>
Choose simple, brute-force representations.
The point here is to put pressure on the specs and the tests, and try to pull your whole program together as soon as possible.
Make the whole program work correctly first.
Skip the advanced features for now.
Skip performance optimization.
Skip corner cases.
Keep a to-do list of what you have to revisit.</li>
<li><strong>Iterate</strong>.
Now that it’s all working, make it work better.
Reimplement, optimize, redesign if necessary.</li>
</ol></div>

</div></div><h2 id="summary"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#summary"></a>Summary</h2><div data-outline="summary">

<ul id="@invariant_property_always">
<li><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@invariant_property_always"></a>An <strong><em>invariant</em></strong> is a property that is always true of an ADT object instance, for the lifetime of the object.</li>
<li>A good ADT <strong><em>preserves its own invariants</em></strong>. Invariants must be established by creators and producers, and preserved by observers and mutators.</li>
<li>The <strong><em>rep invariant</em></strong> specifies legal values of the representation, and should be checked at runtime with <code>checkRep()</code>.</li>
<li>The <strong><em>abstraction function</em></strong> maps a concrete representation to the abstract value it represents.</li>
<li>The <strong><em>rep</em></strong> of an immutable ADT <strong><em>may change</em></strong>, as long as the <strong><em>abstract value</em></strong> it represents <strong><em>doesn’t change</em></strong>.</li>
<li><strong><em>Representation exposure</em></strong> threatens both representation independence and invariant preservation.</li>
<li>An invariant should be documented, by comments or even better by assertions like <code>checkRep()</code>, <em>otherwise the invariant is <strong>not safe from bugs</strong></em>.</li>
</ul>

<p id="@topics_today-s_reading"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@topics_today-s_reading"></a>The topics of today’s reading connect to our three properties of good software as follows:</p>

<ul>
<li><p id="@safe_bugs_good"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@safe_bugs_good"></a><strong>Safe from bugs.</strong>  A good ADT preserves its own invariants, so that those invariants are less vulnerable to bugs in the ADT’s clients, and violations of the invariants can be more easily isolated within the implementation of the ADT itself.  Stating the rep invariant explicitly, and checking it at runtime with <code>checkRep()</code>, catches misunderstandings and bugs earlier, rather than continuing on with a corrupt data structure.</p></li>
<li><p id="@easy_understand_rep"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@easy_understand_rep"></a><strong>Easy to understand.</strong>  Rep invariants and abstraction functions explicate the meaning of a data type’s representation, and how it relates to its abstraction.</p></li>
<li><p id="@ready_change_abstract"><a class="jump" href="https://web.mit.edu/6.102/www/sp25/classes/07-abstraction-functions-rep-invariants/#@ready_change_abstract"></a><strong>Ready for change.</strong> Abstract data types separate the abstraction from the concrete representation, which makes it possible to change the representation without having to change client code.</p></li>
</ul></div></div>

</div></main>
<footer class="col-sm-2 footer-margin"><div>Collaboratively authored by Rob Miller and Max Goldman, with contributions from Saman Amarasinghe, Adam Chlipala, Srini Devadas, Gabriella Ecanow, Michael Ernst, John Guttag, Daniel Jackson, Josiah McMenamy, Martin Rinard, and Armando Solar-Lezama, and from Robert Durfee, Jenna Himawan, Stacia Johanna, Jessica Shi, Daniel Whatley, and Elizabeth Zhou. This work is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC&nbsp;BY-SA&nbsp;4.0</a>.</div></footer>
<script type="text/javascript" charset="utf-8" src="./RepInvariants_files/jquery.min.js.download"></script>


<script type="text/javascript" charset="utf-8" src="./RepInvariants_files/bootstrap.min.js.download"></script><footer>MIT EECS</footer><footer class="footer-archived"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block; vertical-align: text-bottom;"><path fill-rule="evenodd" d="M1.75 2.5a.25.25 0 00-.25.25v1.5c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25v-1.5a.25.25 0 00-.25-.25H1.75zM0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v1.5A1.75 1.75 0 0114.25 6H1.75A1.75 1.75 0 010 4.25v-1.5zM1.75 7a.75.75 0 01.75.75v5.5c0 .138.112.25.25.25h10.5a.25.25 0 00.25-.25v-5.5a.75.75 0 111.5 0v5.5A1.75 1.75 0 0113.25 15H2.75A1.75 1.75 0 011 13.25v-5.5A.75.75 0 011.75 7zm4.5 1a.75.75 0 000 1.5h3.5a.75.75 0 100-1.5h-3.5z"></path></svg>  spring 2025 course site archive  |  latest&nbsp;site&nbsp;at&nbsp;<a href="http://web.mit.edu/6.102/">mit.edu/6.102</a>  |  <a href="http://accessibility.mit.edu/">accessibility</a></footer><script type="text/javascript" charset="utf-8" src="./RepInvariants_files/handout-run.js.download" data-handx-url="https://handx.mit.edu/v1/6.102/sp25/" data-handx-id="classes-07-abstraction-functions-rep-invariants"></script></body><!--
Handout delivered Fri May 23 2025 13:30:49 GMT+0000 (Coordinated Universal Time)
--><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>